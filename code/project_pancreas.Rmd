```{r}
#Load libraries (note: not all may be used for final version)
#load("project_pancreas.RData") pancreas can be replaced with any cancer we have data for such a ovarian and liver
library(dplyr)
library(ggplot2)
library(plot3D)
library(plotly)
library(tidyverse)
library(naniar)
library(magrittr)
library(qwraps2)
library(ranger)
library(ggfortify)
library(boot)
library(table1)
library(gridExtra)
library(msm)
library(knitr)
library(survival)
library(survminer)
library(readxl)
library(ggridges)
library(ggalt)
library(lubridate)
```

Relevant Variables for analysis
-Variables for groups such as age category (at diagnosis), race, and sex
-Want both age category and singular age
-Different types of treatments, interventions, etc. or lack thereof (treatment)
-Date of diagnosis
-Date of treatment
-Date of death
-Birth date
-Time between diagnosis and treatment
-Time between treatment and death
-Time between diagnosis and death

```{r}
#This is SEER specific manipulations
df_pancreas <- read.csv("project_pancreas.csv")

#name columns
colnames(df_pancreas) <- c("Patient_ID", "Age_Cat", "Sex", "Race_Origin", "Year_Birth", "Year_Diagnosis", "Age_Diagnosis", "Month_Diagnosis", "Reason_No_Surgery", "Chemotherapy", "Radiation_With_Surgery", "COD", "COD_Specific", "COD_Other", "Survival_Months", "Survial_Months_Flag", "Vital_Status", "Follow_Up", "Sequence_Number", "First_Malignant_Primary_Indicator")

#replace unknown survival values with missing values
df_pancreas <- df_pancreas %>% replace_with_na(replace = list(Survival_Months = c("Unknown")))

#turn survival into a numeric value
df_pancreas$Survival_Months <- as.integer(df_pancreas$Survival_Months)

#calculate eyar of death
df_pancreas$Year_Death <- ifelse(df_pancreas$Vital_Status == "Alive", "Alive", floor((df_pancreas$Year_Diagnosis*12 + df_pancreas$Survival_Months)/12))

#categorize patients as having surgery or not having surgery
df_pancreas$Surgery <- ifelse(df_pancreas$Reason_No_Surgery == "Surgery performed", "Yes", ifelse(df_pancreas$Reason_No_Surgery == "Not recommended" | df_pancreas$Reason_No_Surgery == "Not recommended, contraindicated due to other cond; autopsy only (1973-2002)" | df_pancreas$Reason_No_Surgery == "Recommended but not performed, unknown reason" | df_pancreas$Reason_No_Surgery == "Not performed, patient died prior to recommended surgery" | df_pancreas$Reason_No_Surgery == "Recommended but not performed, patient refused", "No", "Unknown"))

#calculate age at death
df_pancreas$Age_Death <- ifelse(df_pancreas$Year_Death == "Alive", "Alive", as.integer(df_pancreas$Year_Death) - df_pancreas$Year_Birth)

#categorize age at death
df_pancreas$Age_Death_Cat <- ifelse(df_pancreas$Age_Death == "Alive", "Alive", ifelse(as.integer(df_pancreas$Age_Death) == 0, "00 years", ifelse(as.integer(df_pancreas$Age_Death) >= 1 & as.integer(df_pancreas$Age_Death) <= 4, "01-04 years", ifelse(as.integer(df_pancreas$Age_Death) >= 5 & as.integer(df_pancreas$Age_Death) <= 9, "05-09 years", ifelse(as.integer(df_pancreas$Age_Death) >= 10 & as.integer(df_pancreas$Age_Death) <= 14, "10-14 years", ifelse(as.integer(df_pancreas$Age_Death) >= 15 & as.integer(df_pancreas$Age_Death) <= 19, "15-19 years", ifelse(as.integer(df_pancreas$Age_Death) >= 20 & as.integer(df_pancreas$Age_Death) <= 24, "20-24 years", ifelse(as.integer(df_pancreas$Age_Death) >= 25 & as.integer(df_pancreas$Age_Death) <= 29, "25-29 years", ifelse(as.integer(df_pancreas$Age_Death) >= 30 & as.integer(df_pancreas$Age_Death) <= 34, "30-34 years", ifelse(as.integer(df_pancreas$Age_Death) >= 35 & as.integer(df_pancreas$Age_Death) <= 39, "35-39 years", ifelse(as.integer(df_pancreas$Age_Death) >= 40 & as.integer(df_pancreas$Age_Death) <= 44, "40-44 years", ifelse(as.integer(df_pancreas$Age_Death) >= 45 & as.integer(df_pancreas$Age_Death) <= 49, "45-49 years", ifelse(as.integer(df_pancreas$Age_Death) >= 50 & as.integer(df_pancreas$Age_Death) <= 54, "50-54 years", ifelse(as.integer(df_pancreas$Age_Death) >= 55 & as.integer(df_pancreas$Age_Death) <= 59, "55-59 years", ifelse(as.integer(df_pancreas$Age_Death) >= 60 & as.integer(df_pancreas$Age_Death) <= 64, "60-64 years", ifelse(as.integer(df_pancreas$Age_Death) >= 65 & as.integer(df_pancreas$Age_Death) <= 69, "65-69 years", ifelse(as.integer(df_pancreas$Age_Death) >= 70 & as.integer(df_pancreas$Age_Death) <= 74, "70-74 years", ifelse(as.integer(df_pancreas$Age_Death) >= 75 & as.integer(df_pancreas$Age_Death) <= 79, "75-79 years", ifelse(as.integer(df_pancreas$Age_Death) >= 80 & as.integer(df_pancreas$Age_Death) <= 84, "80-84 years", "85+ years")))))))))))))))))))

#determine if age at death is in the same age category as age of diagnosis
df_pancreas$same_age_cat <- ifelse(df_pancreas$Age_Cat == df_pancreas$Age_Death_Cat, "Yes", "No")

#calculate age in months
df_pancreas$Age_Diagnosis_In_Months <- (df_pancreas$Age_Diagnosis)*12

#calculate month cutoffs for age categories
df_pancreas$month_cutoff <- ifelse(df_pancreas$Age_Cat=="00 years", 12, ifelse(df_pancreas$Age_Cat=="01-04 years", 60, ifelse(df_pancreas$Age_Cat=="05-09 years", 120, ifelse(df_pancreas$Age_Cat=="10-14 years", 180, ifelse(df_pancreas$Age_Cat=="15-19 years", 240, ifelse(df_pancreas$Age_Cat=="20-24 years", 300, ifelse(df_pancreas$Age_Cat=="25-29 years", 360, ifelse(df_pancreas$Age_Cat=="30-34 years", 420, ifelse(df_pancreas$Age_Cat=="35-39 years", 480, ifelse(df_pancreas$Age_Cat=="40-44 years", 540, ifelse(df_pancreas$Age_Cat=="45-49 years", 600, ifelse(df_pancreas$Age_Cat=="50-54 years", 660, ifelse(df_pancreas$Age_Cat=="55-59 years", 720, ifelse(df_pancreas$Age_Cat=="60-64 years", 780, ifelse(df_pancreas$Age_Cat=="65-69 years", 840, ifelse(df_pancreas$Age_Cat=="70-74 years", 900, ifelse(df_pancreas$Age_Cat=="75-79 years", 960, ifelse(df_pancreas$Age_Cat=="80-84 years", 1020, 100000))))))))))))))))))

#only include diagnoses after 2000
df_pancreas <- df_pancreas %>% filter(Year_Diagnosis >= 2000)

#rename race variable
df_pancreas <- df_pancreas %>% mutate(Race_Origin = case_when((df_pancreas$Race_Origin == "Non-Hispanic White") ~ "Caucasian",
                                                                  (df_pancreas$Race_Origin == "Non-Hispanic Black") ~ "African American",
                                                                  (df_pancreas$Race_Origin == "Non-Hispanic Asian or Pacific Islander") ~ "Asian or Pacific Islander",
                                                                  (df_pancreas$Race_Origin == "Hispanic (All Races)") ~ "Hispanic"))

#remove missing values
df_pancreas <- df_pancreas %>% drop_na()
```

```{r}
#We need to calculate expected survival time for those that are still alive. To do this, we assign the average survival time of all dead individuals who match the categories (age, race, and sex) of a given alive individual and have lived as long or longer than the current alive individual
for(s in 1:nrow(df_pancreas))
{
  if(df_pancreas$Vital_Status[s] == "Dead")
  {
    df_pancreas$new_survival[s] <- df_pancreas$Survival_Months[s]
  }
  if(df_pancreas$Vital_Status[s] == "Alive")
  {
    survival_dead <- df_pancreas %>% filter(Age_Cat == df_pancreas$Age_Cat[s]) %>% filter(Sex == df_pancreas$Sex[s]) %>% filter(Race_Origin == df_pancreas$Race_Origin[s]) %>% filter(Surgery == df_pancreas$Surgery[s]) %>% filter(Survival_Months >= df_pancreas$Survival_Months[s]) %>% filter(Vital_Status == "Dead") %>% select(Survival_Months)
    df_pancreas$new_survival[s] <- mean(survival_dead$Survival_Months)
  }
}
```

```{r}
#remove missing values from individuals. this occurs when no one who has already died lived longer than the current alive individual.
df_pancreas <- df_pancreas %>% replace_with_na(replace = list(new_survival = c("NaN")))

df_pancreas <- df_pancreas %>% drop_na()
```

We use these sources to get information about expected survival times for our different categories

SOURCES: 
https://www.cdc.gov/nchs/data/hus/2017/015.pdf_pancreas
https://minorityhealth.hhs.gov/omh/browse.aspx?lvl=3&lvlid=63#:~:text=Health%3A%20According%20to%20Census%20Bureau,and%2078.4%20years%20for%20men.

We calculate 4 sets of synthetic data. We assume that there is a u probability that some type of screening will detect our cancer of choice early and that we can remove the cancer. When removed early, an individual is expected to live a normal lifespan and is assigned synthetic survival data based on their category (age, race, sex). If they are not detected early, they maintain their current survival time. Our 4 sets of synthetic data are 25%, 50%, 75% and 100% chance of early detection.

SYNTHETIC DATA 25%

```{r}
#will only include comments for first couple of sections. The process is the same for 50%, 75%, and 100% with the only difference being the cutoff for u.
#set seed for consistent results
set.seed(8675309)

#create a new column to assign synthetic data to
df_pancreas$new_survival_early25 <- df_pancreas$new_survival
for(t in 1:nrow(df_pancreas))
{
  #random uniform number determines whether an individual is detected early or not
  u <- runif(1, 0, 1)
  
  #section off from 0-64 since after 64 there are conditional expected lifetimes
  if(df_pancreas$Age_Cat[t] %in% c("00 years","01-04 years", "05-09 years", "10-14 years", "15-19 years", "20-24 years", "25-29 years", "30-34 years", "35-39 years", "40-44 years", "45-49 years", "50-54 years", "55-59 years", "60-64 years"))
  {
    if(u <= 0.25)
    {
      #76.1 is the expected lifetime of a caucasian male. If u <= 0.25 then they are assigned this value. We do not assign them this value if they already lived longer than        the expected lifetime
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (76.1*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 76.1*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (81.0*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 81.0*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (71.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 71.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (77.9*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 77.9*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (79.1*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 79.1*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (84.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 84.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (78.4*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 78.4*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (82.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 82.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
    }
  }
  
  #if an individual has lived above 65 years of age, their expected lifetime is greater conditionally.
  if(df_pancreas$Age_Cat[t] %in% c("65-69 years", "70-74 years"))
  {
    if(u <= 0.25)
    {
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (83*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 83*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (85.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 85.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (81.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 81.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (84.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 84.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (84.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 84.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 87.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (83*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 83*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (85.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 85.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
    }
  }
  
  #As with before, if an individual has lived above 75 years of age, their expected lifetime is greater conditionally.
  if(df_pancreas$Age_Cat[t] %in% c("75-79 years", "80-84 years", "85+ years"))
  {
    if(u <= 0.25)
    {
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (86.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 86.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.9*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 87.9*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (85.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 85.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 87.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (87.6*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 87.6*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (89.6*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 89.6*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (86.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 86.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.9*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early25[t] <- 87.9*12 - df_pancreas$Age_Diagnosis[t]*12
      }
    }
  }
}
```

SYNTHETIC DATA 50%

```{r}
set.seed(8675309)
df_pancreas$new_survival_early50 <- df_pancreas$new_survival
for(t in 1:nrow(df_pancreas))
{
  u <- runif(1, 0, 1)
  if(df_pancreas$Age_Cat[t] %in% c("00 years","01-04 years", "05-09 years", "10-14 years", "15-19 years", "20-24 years", "25-29 years", "30-34 years", "35-39 years", "40-44 years", "45-49 years", "50-54 years", "55-59 years", "60-64 years"))
  {
    if(u <= 0.5)
    {
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (76.1*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 76.1*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (81.0*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 81.0*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (71.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 71.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (77.9*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 77.9*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (79.1*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 79.1*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (84.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 84.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (78.4*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 78.4*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (82.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 82.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
    }
  }
  
  if(df_pancreas$Age_Cat[t] %in% c("65-69 years", "70-74 years"))
  {
    if(u <= 0.5)
    {
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (83*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 83*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (85.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 85.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (81.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 81.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (84.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 84.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (84.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 84.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 87.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (83*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 83*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (85.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 85.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
    }
  }
  
  if(df_pancreas$Age_Cat[t] %in% c("75-79 years", "80-84 years", "85+ years"))
  {
    if(u <= 0.5)
    {
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (86.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 86.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.9*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 87.9*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (85.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 85.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 87.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (87.6*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 87.6*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (89.6*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 89.6*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (86.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 86.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.9*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early50[t] <- 87.9*12 - df_pancreas$Age_Diagnosis[t]*12
      }
    }
  }
}
```

SYNTHETIC DATA 75%

```{r}
set.seed(8675309)
df_pancreas$new_survival_early75 <- df_pancreas$new_survival
for(t in 1:nrow(df_pancreas))
{
  u <- runif(1, 0, 1)
  if(df_pancreas$Age_Cat[t] %in% c("00 years","01-04 years", "05-09 years", "10-14 years", "15-19 years", "20-24 years", "25-29 years", "30-34 years", "35-39 years", "40-44 years", "45-49 years", "50-54 years", "55-59 years", "60-64 years"))
  {
    if(u <= 0.75)
    {
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (76.1*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 76.1*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (81.0*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 81.0*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (71.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 71.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (77.9*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 77.9*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (79.1*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 79.1*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (84.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 84.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (78.4*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 78.4*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (82.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 82.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
    }
  }
  
  if(df_pancreas$Age_Cat[t] %in% c("65-69 years", "70-74 years"))
  {
    if(u <= 0.75)
    {
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (83*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 83*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (85.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 85.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (81.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 81.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (84.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 84.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (84.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 84.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 87.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (83*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 83*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (85.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 85.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
    }
  }
  
  if(df_pancreas$Age_Cat[t] %in% c("75-79 years", "80-84 years", "85+ years"))
  {
    if(u <= 0.75)
    {
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (86.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 86.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.9*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 87.9*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (85.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 85.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 87.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (87.6*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 87.6*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (89.6*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 89.6*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (86.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 86.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.9*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early75[t] <- 87.9*12 - df_pancreas$Age_Diagnosis[t]*12
      }
    }
  }
}
```

SYNTHETIC DATA 100%

```{r}
set.seed(8675309)
df_pancreas$new_survival_early100 <- df_pancreas$new_survival
for(t in 1:nrow(df_pancreas))
{
  u <- runif(1, 0, 1)
  if(df_pancreas$Age_Cat[t] %in% c("00 years","01-04 years", "05-09 years", "10-14 years", "15-19 years", "20-24 years", "25-29 years", "30-34 years", "35-39 years", "40-44 years", "45-49 years", "50-54 years", "55-59 years", "60-64 years"))
  {
    if(u <= 1)
    {
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (76.1*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 76.1*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (81.0*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 81.0*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (71.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 71.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (77.9*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 77.9*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (79.1*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 79.1*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (84.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 84.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (78.4*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 78.4*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (82.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 82.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
    }
  }
  
  if(df_pancreas$Age_Cat[t] %in% c("65-69 years", "70-74 years"))
  {
    if(u <= 1)
    {
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (83*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 83*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (85.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 85.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (81.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 81.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (84.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 84.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (84.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 84.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 87.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (83*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 83*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (85.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 85.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
    }
  }
  
  if(df_pancreas$Age_Cat[t] %in% c("75-79 years", "80-84 years", "85+ years"))
  {
    if(u <= 1)
    {
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (86.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 86.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Caucasian" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.9*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 87.9*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (85.5*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 85.5*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "African American" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.7*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 87.7*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (87.6*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 87.6*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Hispanic" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (89.6*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 89.6*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Male" & df_pancreas$new_survival[t] <= (86.2*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 86.2*12 - df_pancreas$Age_Diagnosis[t]*12
      }
      if(df_pancreas$Race_Origin[t] == "Asian or Pacific Islander" & df_pancreas$Sex[t] == "Female" & df_pancreas$new_survival[t] <= (87.9*12 - df_pancreas$Age_Diagnosis[t]*12))
      {
        df_pancreas$new_survival_early100[t] <- 87.9*12 - df_pancreas$Age_Diagnosis[t]*12
      }
    }
  }
}
```

Now we program our model to calculate expected residual lifetime gained. Expected residual lifetime gained is calculated using queuing network models discussed in the paper. It is defined as the expected lifetime gained from a new proposed treatment/screen compared to a current treatment/screen

```{r, message=FALSE, warning=FALSE}
#create lists of race, age, sex, and years to reference
race <- unique(df_pancreas$Race_Origin)
age <- unique(df_pancreas$Age_Cat)
sex <- unique(df_pancreas$Sex)
years <- unique(df_pancreas$Year_Diagnosis)

#Start with 25% synthetic data. Comments will only be provided for this section cause all future sections are the same except for which column of survival data is used.

#Create a matrix that has enoguh rows for every category combination
plot_data_pancreas25 <- data.frame(matrix(ncol = 14, nrow = length(race)*length(age)*length(sex)))
colnames(plot_data_pancreas25) <- c("race", "age", "sex", "h", "m10", "m12", "m1", "m2", "m3", "r10", "r12", "estimate", "survival_months", "sample_size")

l = 1
#for every combination of race, age, and sex, calculate an estimate
for(i in race)
{
  for(j in age)
  {
    for(k in sex)
    {
      #filter data to only include people from the desired category
      data_filtered <- df_pancreas %>% 
        filter(Race_Origin == i) %>% 
        filter(Age_Cat == j) %>% filter(Sex == k)
      
      #calculate sample size
      sample_size <- nrow(data_filtered)
      
      #create a dataset of the number of people diagnosed each year
      diagnosis <- data_filtered %>% 
        count(Year_Diagnosis)
      
      #fill in years with no counts as 0
      for(y in years)
      {
        if(is.element(y, diagnosis$Year_Diagnosis)==FALSE)
        {
          diagnosis <- rbind(diagnosis, c(y, 0))
          colnames(diagnosis)<-c("Year_Diagnosis", "n")
        }
      }
      
      #order the list by year
      diagnosis <- diagnosis[order(diagnosis$Year_Diagnosis),] 
      
      #h is the average number of people diagnosed per year
      h <- mean(diagnosis$n)
      
      #m2 is 1 over the average survival time using original data
      m2 <- 1/(mean(data_filtered$new_survival, na.rm = TRUE))
      
      #replace missing values with 0
      if(is.nan(m2) ==TRUE | is.na(m2)==TRUE)
      {
        m2 <- 0
      }
      
      #m3 is 1 over the averag survival time using synthetic data
      m3 <- 1/(mean(data_filtered$new_survival_early25, na.rm = TRUE))
      
      #replace missing values with 0
      if(is.nan(m3) ==TRUE | is.na(m3)==TRUE)
      {
        m3 <- 0
      }
      
      #m1 is the rate at which people leave the diagnosed compartment and move to the treated compartment. We do not have data for this so we        arbitrarily choose 1/6
      m1 <- 1/6
      
      #r12 is the proportion of individuals who leave the diagnosed compartment and go to the early screening compartment
      r12 <- 0.9
      
      #r10 is the proportion of individuals who leave the diagnosed compartment via dying
      r10 <- 1 - r12
      
      m10 <- r10*m1
      m12 <- r12*m1
      
      #store average survival time for data checking
      survival_time <- mean(data_filtered$Survival_Months)
      
      #calculate estimate
      estimate <- (1/(m10+m12)+m12/(m3*(m10+m12))) -  (1/(m10+m12)+m12/(m2*(m10+m12)))
      
      
      plot_data_pancreas25[l,] <- c(i, j, k, h, m10, m12, m1, m2, m3, r10, r12, estimate, survival_time, sample_size)
      l = l + 1
    }
  }
}

#replace unknown values with missing
plot_data_pancreas25 <- plot_data_pancreas25 %>% replace_with_na(replace = list(race = c("Non-Hispanic Unknown Race"), age = c("85+ years"), h = c("NaN"), m10 = c("NaN"), m12 = c("NaN"), m1 = c("NaN"), m2 = c("NaN"), m3 = c("NaN"), estimate = c("NaN", "Inf", "-Inf"), survival_months = c("NaN")))

plot_data_pancreas25 <- plot_data_pancreas25 %>% drop_na()

#make age_label a numeric value for ordering
plot_data_pancreas25$age_label <- ifelse(plot_data_pancreas25$age == "00 years", 1, ifelse(plot_data_pancreas25$age == "01-04 years", 2, ifelse(plot_data_pancreas25$age == "05-09 years", 3, ifelse(plot_data_pancreas25$age == "10-14 years", 4, ifelse(plot_data_pancreas25$age == "15-19 years", 5, ifelse(plot_data_pancreas25$age == "20-24 years", 6, ifelse(plot_data_pancreas25$age == "25-29 years", 7, ifelse(plot_data_pancreas25$age == "30-34 years", 8, ifelse(plot_data_pancreas25$age == "35-39 years", 9, ifelse(plot_data_pancreas25$age == "40-44 years", 10, ifelse(plot_data_pancreas25$age == "45-49 years", 11, ifelse(plot_data_pancreas25$age == "50-54 years", 12, ifelse(plot_data_pancreas25$age == "55-59 years", 13, ifelse(plot_data_pancreas25$age == "60-64 years", 14, ifelse(plot_data_pancreas25$age == "65-69 years", 15, ifelse(plot_data_pancreas25$age == "70-74 years", 16, ifelse(plot_data_pancreas25$age == "75-79 years", 17, ifelse(plot_data_pancreas25$age == "80-84 years", 18, 19))))))))))))))))))

#make sure all values are numeric
plot_data_pancreas25$h <- as.numeric(plot_data_pancreas25$h)
plot_data_pancreas25$m10 <- as.numeric(plot_data_pancreas25$m10)
plot_data_pancreas25$m12 <- as.numeric(plot_data_pancreas25$m12)
plot_data_pancreas25$m1 <- as.numeric(plot_data_pancreas25$m1)
plot_data_pancreas25$m2 <- as.numeric(plot_data_pancreas25$m2)
plot_data_pancreas25$m3 <- as.numeric(plot_data_pancreas25$m3)
plot_data_pancreas25$r10 <- as.numeric(plot_data_pancreas25$r10)
plot_data_pancreas25$r12 <- as.numeric(plot_data_pancreas25$r12)
plot_data_pancreas25$estimate <- as.numeric(plot_data_pancreas25$estimate)
plot_data_pancreas25$survival_months <- as.numeric(plot_data_pancreas25$survival_months)
plot_data_pancreas25$sample_size <- as.numeric(plot_data_pancreas25$sample_size)

#sort data by age
plot_data_pancreas25 <- arrange(plot_data_pancreas25, age, desc())

#only keep groups with sample sizes greater than 100
plot_data_pancreas25 <- plot_data_pancreas25 %>% filter(sample_size >= 100)

# REPEAT FOR 50% SYNTHETIC DATA

plot_data_pancreas50 <- data.frame(matrix(ncol = 14, nrow = length(race)*length(age)*length(sex)))
colnames(plot_data_pancreas50) <- c("race", "age", "sex", "h", "m10", "m12", "m1", "m2", "m3", "r10", "r12", "estimate", "survival_months", "sample_size")

l = 1
for(i in race)
{
  for(j in age)
  {
    for(k in sex)
    {
      data_filtered <- df_pancreas %>% 
        filter(Race_Origin == i) %>% 
        filter(Age_Cat == j) %>% filter(Sex == k)
      
      sample_size <- nrow(data_filtered)
      
      diagnosis <- data_filtered %>% 
        count(Year_Diagnosis)
      
      for(y in years)
      {
        if(is.element(y, diagnosis$Year_Diagnosis)==FALSE)
        {
          diagnosis <- rbind(diagnosis, c(y, 0))
          colnames(diagnosis)<-c("Year_Diagnosis", "n")
        }
      }
      
      diagnosis <- diagnosis[order(diagnosis$Year_Diagnosis),] 
      
      h <- mean(diagnosis$n)
      
      m2 <- 1/(mean(data_filtered$new_survival, na.rm = TRUE))
      
      if(is.nan(m2) ==TRUE | is.na(m2)==TRUE)
      {
        m2 <- 0
      }
      
      m3 <- 1/(mean(data_filtered$new_survival_early50, na.rm = TRUE))
      
      if(is.nan(m3) ==TRUE | is.na(m3)==TRUE)
      {
        m3 <- 0
      }
      
      m1 <- 1/6
      
      r12 <- 0.9
      
      r10 <- 1 - r12
      
      m10 <- r10*m1
      m12 <- r12*m1
      
      survival_time <- mean(data_filtered$Survival_Months)
      
      estimate <- (1/(m10+m12)+m12/(m3*(m10+m12))) -  (1/(m10+m12)+m12/(m2*(m10+m12)))
      
      
      plot_data_pancreas50[l,] <- c(i, j, k, h, m10, m12, m1, m2, m3, r10, r12, estimate, survival_time, sample_size)
      l = l + 1
    }
  }
}

plot_data_pancreas50 <- plot_data_pancreas50 %>% replace_with_na(replace = list(race = c("Non-Hispanic Unknown Race"), age = c("85+ years"), h = c("NaN"), m10 = c("NaN"), m12 = c("NaN"), m1 = c("NaN"), m2 = c("NaN"), m3 = c("NaN"), estimate = c("NaN", "Inf", "-Inf"), survival_months = c("NaN")))

plot_data_pancreas50 <- plot_data_pancreas50 %>% drop_na()

plot_data_pancreas50$age_label <- ifelse(plot_data_pancreas50$age == "00 years", 1, ifelse(plot_data_pancreas50$age == "01-04 years", 2, ifelse(plot_data_pancreas50$age == "05-09 years", 3, ifelse(plot_data_pancreas50$age == "10-14 years", 4, ifelse(plot_data_pancreas50$age == "15-19 years", 5, ifelse(plot_data_pancreas50$age == "20-24 years", 6, ifelse(plot_data_pancreas50$age == "25-29 years", 7, ifelse(plot_data_pancreas50$age == "30-34 years", 8, ifelse(plot_data_pancreas50$age == "35-39 years", 9, ifelse(plot_data_pancreas50$age == "40-44 years", 10, ifelse(plot_data_pancreas50$age == "45-49 years", 11, ifelse(plot_data_pancreas50$age == "50-54 years", 12, ifelse(plot_data_pancreas50$age == "55-59 years", 13, ifelse(plot_data_pancreas50$age == "60-64 years", 14, ifelse(plot_data_pancreas50$age == "65-69 years", 15, ifelse(plot_data_pancreas50$age == "70-74 years", 16, ifelse(plot_data_pancreas50$age == "75-79 years", 17, ifelse(plot_data_pancreas50$age == "80-84 years", 18, 19))))))))))))))))))

plot_data_pancreas50$h <- as.numeric(plot_data_pancreas50$h)
plot_data_pancreas50$m10 <- as.numeric(plot_data_pancreas50$m10)
plot_data_pancreas50$m12 <- as.numeric(plot_data_pancreas50$m12)
plot_data_pancreas50$m1 <- as.numeric(plot_data_pancreas50$m1)
plot_data_pancreas50$m2 <- as.numeric(plot_data_pancreas50$m2)
plot_data_pancreas50$m3 <- as.numeric(plot_data_pancreas50$m3)
plot_data_pancreas50$r10 <- as.numeric(plot_data_pancreas50$r10)
plot_data_pancreas50$r12 <- as.numeric(plot_data_pancreas50$r12)
plot_data_pancreas50$estimate <- as.numeric(plot_data_pancreas50$estimate)
plot_data_pancreas50$survival_months <- as.numeric(plot_data_pancreas50$survival_months)
plot_data_pancreas50$sample_size <- as.numeric(plot_data_pancreas50$sample_size)

plot_data_pancreas50 <- arrange(plot_data_pancreas50, age, desc())

plot_data_pancreas50 <- plot_data_pancreas50 %>% filter(sample_size >= 100)

# REPEAT FOR 75% SYNTHERIC DATA

plot_data_pancreas75 <- data.frame(matrix(ncol = 14, nrow = length(race)*length(age)*length(sex)))
colnames(plot_data_pancreas75) <- c("race", "age", "sex", "h", "m10", "m12", "m1", "m2", "m3", "r10", "r12", "estimate", "survival_months", "sample_size")

l = 1
for(i in race)
{
  for(j in age)
  {
    for(k in sex)
    {
      data_filtered <- df_pancreas %>% 
        filter(Race_Origin == i) %>% 
        filter(Age_Cat == j) %>% filter(Sex == k)
      
      sample_size <- nrow(data_filtered)
      
      diagnosis <- data_filtered %>% 
        count(Year_Diagnosis)
      
      for(y in years)
      {
        if(is.element(y, diagnosis$Year_Diagnosis)==FALSE)
        {
          diagnosis <- rbind(diagnosis, c(y, 0))
          colnames(diagnosis)<-c("Year_Diagnosis", "n")
        }
      }
      
      diagnosis <- diagnosis[order(diagnosis$Year_Diagnosis),] 
      
      h <- mean(diagnosis$n)
      
      m2 <- 1/(mean(data_filtered$new_survival, na.rm = TRUE))
      
      if(is.nan(m2) ==TRUE | is.na(m2)==TRUE)
      {
        m2 <- 0
      }
      
      m3 <- 1/(mean(data_filtered$new_survival_early75, na.rm = TRUE))
      
      if(is.nan(m3) ==TRUE | is.na(m3)==TRUE)
      {
        m3 <- 0
      }
      
      m1 <- 1/6
      
      r12 <- 0.9
      
      r10 <- 1 - r12
      
      m10 <- r10*m1
      m12 <- r12*m1
      
      survival_time <- mean(data_filtered$Survival_Months)
      
      estimate <- (1/(m10+m12)+m12/(m3*(m10+m12))) -  (1/(m10+m12)+m12/(m2*(m10+m12)))
      
      
      plot_data_pancreas75[l,] <- c(i, j, k, h, m10, m12, m1, m2, m3, r10, r12, estimate, survival_time, sample_size)
      l = l + 1
    }
  }
}

plot_data_pancreas75 <- plot_data_pancreas75 %>% replace_with_na(replace = list(race = c("Non-Hispanic Unknown Race"), age = c("85+ years"), h = c("NaN"), m10 = c("NaN"), m12 = c("NaN"), m1 = c("NaN"), m2 = c("NaN"), m3 = c("NaN"), estimate = c("NaN", "Inf", "-Inf"), survival_months = c("NaN")))

plot_data_pancreas75 <- plot_data_pancreas75 %>% drop_na()

plot_data_pancreas75$age_label <- ifelse(plot_data_pancreas75$age == "00 years", 1, ifelse(plot_data_pancreas75$age == "01-04 years", 2, ifelse(plot_data_pancreas75$age == "05-09 years", 3, ifelse(plot_data_pancreas75$age == "10-14 years", 4, ifelse(plot_data_pancreas75$age == "15-19 years", 5, ifelse(plot_data_pancreas75$age == "20-24 years", 6, ifelse(plot_data_pancreas75$age == "25-29 years", 7, ifelse(plot_data_pancreas75$age == "30-34 years", 8, ifelse(plot_data_pancreas75$age == "35-39 years", 9, ifelse(plot_data_pancreas75$age == "40-44 years", 10, ifelse(plot_data_pancreas75$age == "45-49 years", 11, ifelse(plot_data_pancreas75$age == "50-54 years", 12, ifelse(plot_data_pancreas75$age == "55-59 years", 13, ifelse(plot_data_pancreas75$age == "60-64 years", 14, ifelse(plot_data_pancreas75$age == "65-69 years", 15, ifelse(plot_data_pancreas75$age == "70-74 years", 16, ifelse(plot_data_pancreas75$age == "75-79 years", 17, ifelse(plot_data_pancreas75$age == "80-84 years", 18, 19))))))))))))))))))

plot_data_pancreas75$h <- as.numeric(plot_data_pancreas75$h)
plot_data_pancreas75$m10 <- as.numeric(plot_data_pancreas75$m10)
plot_data_pancreas75$m12 <- as.numeric(plot_data_pancreas75$m12)
plot_data_pancreas75$m1 <- as.numeric(plot_data_pancreas75$m1)
plot_data_pancreas75$m2 <- as.numeric(plot_data_pancreas75$m2)
plot_data_pancreas75$m3 <- as.numeric(plot_data_pancreas75$m3)
plot_data_pancreas75$r10 <- as.numeric(plot_data_pancreas75$r10)
plot_data_pancreas75$r12 <- as.numeric(plot_data_pancreas75$r12)
plot_data_pancreas75$estimate <- as.numeric(plot_data_pancreas75$estimate)
plot_data_pancreas75$survival_months <- as.numeric(plot_data_pancreas75$survival_months)
plot_data_pancreas75$sample_size <- as.numeric(plot_data_pancreas75$sample_size)

plot_data_pancreas75 <- arrange(plot_data_pancreas75, age, desc())

plot_data_pancreas75 <- plot_data_pancreas75 %>% filter(sample_size >= 100)

# REPEAT FOR 100% SYNTHETIC DATA

plot_data_pancreas100 <- data.frame(matrix(ncol = 14, nrow = length(race)*length(age)*length(sex)))
colnames(plot_data_pancreas100) <- c("race", "age", "sex", "h", "m10", "m12", "m1", "m2", "m3", "r10", "r12", "estimate", "survival_months", "sample_size")

l = 1
for(i in race)
{
  for(j in age)
  {
    for(k in sex)
    {
      data_filtered <- df_pancreas %>% 
        filter(Race_Origin == i) %>% 
        filter(Age_Cat == j) %>% filter(Sex == k)
      
      sample_size <- nrow(data_filtered)
      
      diagnosis <- data_filtered %>% 
        count(Year_Diagnosis)
      
      for(y in years)
      {
        if(is.element(y, diagnosis$Year_Diagnosis)==FALSE)
        {
          diagnosis <- rbind(diagnosis, c(y, 0))
          colnames(diagnosis)<-c("Year_Diagnosis", "n")
        }
      }
      
      diagnosis <- diagnosis[order(diagnosis$Year_Diagnosis),] 
      
      h <- mean(diagnosis$n)
      
      m2 <- 1/(mean(data_filtered$new_survival, na.rm = TRUE))
      
      if(is.nan(m2) ==TRUE | is.na(m2)==TRUE)
      {
        m2 <- 0
      }
      
      m3 <- 1/(mean(data_filtered$new_survival_early100, na.rm = TRUE))
      
      if(is.nan(m3) ==TRUE | is.na(m3)==TRUE)
      {
        m3 <- 0
      }
      
      m1 <- 1/6
      
      r12 <- 0.9
      
      r10 <- 1 - r12
      
      m10 <- r10*m1
      m12 <- r12*m1
      
      survival_time <- mean(data_filtered$Survival_Months)
      
      estimate <- (1/(m10+m12)+m12/(m3*(m10+m12))) -  (1/(m10+m12)+m12/(m2*(m10+m12)))
      
      
      plot_data_pancreas100[l,] <- c(i, j, k, h, m10, m12, m1, m2, m3, r10, r12, estimate, survival_time, sample_size)
      l = l + 1
    }
  }
}

plot_data_pancreas100 <- plot_data_pancreas100 %>% replace_with_na(replace = list(race = c("Non-Hispanic Unknown Race"), age = c("85+ years"), h = c("NaN"), m10 = c("NaN"), m12 = c("NaN"), m1 = c("NaN"), m2 = c("NaN"), m3 = c("NaN"), estimate = c("NaN", "Inf", "-Inf"), survival_months = c("NaN")))

plot_data_pancreas100 <- plot_data_pancreas100 %>% drop_na()

plot_data_pancreas100$age_label <- ifelse(plot_data_pancreas100$age == "00 years", 1, ifelse(plot_data_pancreas100$age == "01-04 years", 2, ifelse(plot_data_pancreas100$age == "05-09 years", 3, ifelse(plot_data_pancreas100$age == "10-14 years", 4, ifelse(plot_data_pancreas100$age == "15-19 years", 5, ifelse(plot_data_pancreas100$age == "20-24 years", 6, ifelse(plot_data_pancreas100$age == "25-29 years", 7, ifelse(plot_data_pancreas100$age == "30-34 years", 8, ifelse(plot_data_pancreas100$age == "35-39 years", 9, ifelse(plot_data_pancreas100$age == "40-44 years", 10, ifelse(plot_data_pancreas100$age == "45-49 years", 11, ifelse(plot_data_pancreas100$age == "50-54 years", 12, ifelse(plot_data_pancreas100$age == "55-59 years", 13, ifelse(plot_data_pancreas100$age == "60-64 years", 14, ifelse(plot_data_pancreas100$age == "65-69 years", 15, ifelse(plot_data_pancreas100$age == "70-74 years", 16, ifelse(plot_data_pancreas100$age == "75-79 years", 17, ifelse(plot_data_pancreas100$age == "80-84 years", 18, 19))))))))))))))))))

plot_data_pancreas100$h <- as.numeric(plot_data_pancreas100$h)
plot_data_pancreas100$m10 <- as.numeric(plot_data_pancreas100$m10)
plot_data_pancreas100$m12 <- as.numeric(plot_data_pancreas100$m12)
plot_data_pancreas100$m1 <- as.numeric(plot_data_pancreas100$m1)
plot_data_pancreas100$m2 <- as.numeric(plot_data_pancreas100$m2)
plot_data_pancreas100$m3 <- as.numeric(plot_data_pancreas100$m3)
plot_data_pancreas100$r10 <- as.numeric(plot_data_pancreas100$r10)
plot_data_pancreas100$r12 <- as.numeric(plot_data_pancreas100$r12)
plot_data_pancreas100$estimate <- as.numeric(plot_data_pancreas100$estimate)
plot_data_pancreas100$survival_months <- as.numeric(plot_data_pancreas100$survival_months)
plot_data_pancreas100$sample_size <- as.numeric(plot_data_pancreas100$sample_size)

plot_data_pancreas100 <- arrange(plot_data_pancreas100, age, desc())

plot_data_pancreas100 <- plot_data_pancreas100 %>% filter(sample_size >= 100)
```

Next, create a model that doesn't use synthetic data but instead calculates the benefits of standard seer surgery. The code is very similar, although comments will point out noticeable differences

```{r}
plot_data_pancreas0 <- data.frame(matrix(ncol = 12, nrow = length(race)*length(age)*length(sex)))
colnames(plot_data_pancreas0) <- c("race", "age", "sex", "m10", "m12", "m1", "m2", "r10", "r12", "estimate", "survival_months", "sample_size")

l = 1
for(i in race)
{
  for(j in age)
  {
    for(k in sex)
    {
      data_filtered <- df_pancreas %>% 
        filter(Race_Origin == i) %>% 
        filter(Age_Cat == j) %>% 
        filter(Sex == k)
      
      sample_size <- nrow(data_filtered)
      
      diagnosis <- data_filtered %>% 
        count(Year_Diagnosis)
      
      #Like diagnosis calculate the number of people who received surgery in a given year
      surgery <- data_filtered %>% 
        filter(Surgery == "Yes") %>% 
        count(Year_Diagnosis)
      
      #Number of people who did not receive surgery in a given year
      no_surgery <- data_filtered %>% 
        filter(Surgery == "No") %>% count(Year_Diagnosis)
      
      #Number of people who received surgery and died in a given year
      surgery_death <- data_filtered %>% 
        filter(Surgery == "Yes") %>% 
        filter(Vital_Status == "Dead") %>%
        count(Year_Diagnosis)
      
      #Number of people who did not receive surgery and died in a given year
      no_surgery_death <- data_filtered %>% 
        filter(Surgery == "No") %>% 
        filter(Vital_Status == "Dead") %>%
        count(Year_Diagnosis)
      
      #fill in years with no counts as 0
      for(y in years)
      {
        if(is.element(y, diagnosis$Year_Diagnosis)==FALSE)
        {
          diagnosis <- rbind(diagnosis, c(y, 0))
          colnames(diagnosis)<-c("Year_Diagnosis", "n")
        }
        if(is.element(y, surgery$Year_Diagnosis)==FALSE)
        {
          surgery <- rbind(surgery, c(y, 0))
          colnames(surgery)<-c("Year_Diagnosis", "n")
        }
        if(is.element(y, no_surgery$Year_Diagnosis)==FALSE)
        {
          no_surgery <- rbind(no_surgery, c(y, 0))
          colnames(no_surgery)<-c("Year_Diagnosis", "n")
        }
        if(is.element(y, surgery_death$Year_Diagnosis)==FALSE)
        {
          surgery_death <- rbind(surgery_death, c(y, 0))
          colnames(surgery_death)<-c("Year_Diagnosis", "n")
        }
        if(is.element(y, no_surgery_death$Year_Diagnosis)==FALSE)
        {
          no_surgery_death <- rbind(no_surgery_death, c(y, 0))
          colnames(no_surgery_death)<-c("Year_Diagnosis", "n")
        }
      }
      
      #sort by year
      diagnosis <- diagnosis[order(diagnosis$Year_Diagnosis),] 
      surgery <- surgery[order(surgery$Year_Diagnosis),] 
      no_surgery <- no_surgery[order(no_surgery$Year_Diagnosis),] 
      surgery_death <- surgery_death[order(surgery_death$Year_Diagnosis),] 
      no_surgery_death <- no_surgery_death[order(no_surgery_death$Year_Diagnosis),] 
      
      h <- mean(diagnosis$n)
      
      #get a list of those who did not receive surgery and are dead
      m10_dead_cases <- data_filtered %>% 
        filter(Surgery == "No") %>% 
        filter(Vital_Status == "Dead")
      
      #get a list of those who did not receive surgery and are alive
      m10_alive_cases <- data_filtered %>% 
        filter(Surgery == "No") %>% 
        filter(Vital_Status == "Alive")
      
      #combine these cases together
      m10_cases <- rbind(m10_dead_cases, m10_alive_cases)
      
      #m10 is 1 divided by the average survival time of people who did not receive surgery
      m10 <- 1/(mean(m10_cases$new_survival, na.rm = TRUE))
      
      if(is.nan(m10) ==TRUE | is.na(m10)==TRUE)
      {
        m10 <- 0
      }
      
      #m2 is a combination of people who did recieve surgery and uses the same process as m1
      m2_dead_cases <- data_filtered %>% 
        filter(Surgery == "Yes") %>% 
        filter(Vital_Status == "Dead")
      
      m2_alive_cases <- data_filtered %>% 
        filter(Surgery == "Yes") %>% 
        filter(Vital_Status == "Alive")
      
      m2_cases <- rbind(m2_dead_cases, m2_alive_cases)
      
      m2 <- 1/(mean(m2_cases$new_survival, na.rm = TRUE))
      
      if(is.nan(m2) ==TRUE | is.na(m2)==TRUE)
      {
        m2 <- 0
      }
      
      #r12 is the proportion of the average number of people who received surgery in a given year over the average number of people diagnosed        in a given year
      r12 <- mean(surgery$n)/mean(diagnosis$n)
      r10 <- 1 - r12
      
      #we can calculate m12 from m10 and r10. m12 is the rate from diagnosed to treatment (surgery)
      m12 <- m10/r10 - m10
      if(is.nan(m12) ==TRUE | is.na(m12)==TRUE)
      {
        m12 <- 0
      }
      
      m1 <- m10 + m12
      if(is.nan(m1) ==TRUE | is.na(m1)==TRUE)
      {
        m1 <- 0
      }
 
      survival_time <- mean(data_filtered$Survival_Months)
      
      estimate <- (m12*(m10 - m2))/(m10*m2*(m10+m12))
      
      
      plot_data_pancreas0[l,] <- c(i, j, k, m10, m12, m1, m2, r10, r12, estimate, survival_time, sample_size)
      l = l + 1
    }
  }
}



plot_data_pancreas0 <- plot_data_pancreas0 %>% replace_with_na(replace = list(race = c("Non-Hispanic Unknown Race"), age = c("85+ years"), m10 = c("NaN"), m12 = c("NaN"), m1 = c("NaN"), m2 = c("NaN"), estimate = c("NaN", "Inf", "-Inf"), survival_months = c("NaN")))

plot_data_pancreas0 <- plot_data_pancreas0 %>% drop_na()

plot_data_pancreas0$age_label <- ifelse(plot_data_pancreas0$age == "00 years", 1, ifelse(plot_data_pancreas0$age == "01-04 years", 2, ifelse(plot_data_pancreas0$age == "05-09 years", 3, ifelse(plot_data_pancreas0$age == "10-14 years", 4, ifelse(plot_data_pancreas0$age == "15-19 years", 5, ifelse(plot_data_pancreas0$age == "20-24 years", 6, ifelse(plot_data_pancreas0$age == "25-29 years", 7, ifelse(plot_data_pancreas0$age == "30-34 years", 8, ifelse(plot_data_pancreas0$age == "35-39 years", 9, ifelse(plot_data_pancreas0$age == "40-44 years", 10, ifelse(plot_data_pancreas0$age == "45-49 years", 11, ifelse(plot_data_pancreas0$age == "50-54 years", 12, ifelse(plot_data_pancreas0$age == "55-59 years", 13, ifelse(plot_data_pancreas0$age == "60-64 years", 14, ifelse(plot_data_pancreas0$age == "65-69 years", 15, ifelse(plot_data_pancreas0$age == "70-74 years", 16, ifelse(plot_data_pancreas0$age == "75-79 years", 17, ifelse(plot_data_pancreas0$age == "80-84 years", 18, 19))))))))))))))))))

plot_data_pancreas0$m10 <- as.numeric(plot_data_pancreas0$m10)
plot_data_pancreas0$m12 <- as.numeric(plot_data_pancreas0$m12)
plot_data_pancreas0$m1 <- as.numeric(plot_data_pancreas0$m1)
plot_data_pancreas0$m2 <- as.numeric(plot_data_pancreas0$m2)
plot_data_pancreas0$r10 <- as.numeric(plot_data_pancreas0$r10)
plot_data_pancreas0$r12 <- as.numeric(plot_data_pancreas0$r12)
plot_data_pancreas0$estimate <- as.numeric(plot_data_pancreas0$estimate)
plot_data_pancreas0$survival_months <- as.numeric(plot_data_pancreas0$survival_months)
plot_data_pancreas0$sample_size <- as.numeric(plot_data_pancreas0$sample_size)

plot_data_pancreas0 <- arrange(plot_data_pancreas0, age, desc())

plot_data_pancreas0 <- plot_data_pancreas0 %>% filter(sample_size >= 100)
```

CREATE SURVIVAL CURVES

```{r}
# Include only the categories that had estimates calculated
# Turn vital status into a numeric value
pancreas_data_survival <- df_pancreas %>% filter(Age_Cat %in% unique(plot_data_pancreas100$age)) %>% filter(Race_Origin %in% unique(plot_data_pancreas100$race)) %>% filter(Sex %in% unique(plot_data_pancreas100$sex)) %>% mutate(status = ifelse(Vital_Status == "Alive", 1, 2)) 

# add new columns of estimates
pancreas_data_survival <- pancreas_data_survival %>% left_join(as.data.frame(plot_data_pancreas0[,c(1,2,3,10)]), by = c("Age_Cat" = "age", "Race_Origin" = "race", "Sex" = "sex")) %>% left_join(as.data.frame(plot_data_pancreas25[,c(1,2,3,12)]), by = c("Age_Cat" = "age", "Race_Origin" = "race", "Sex" = "sex")) %>% left_join(as.data.frame(plot_data_pancreas50[,c(1,2,3,12)]), by = c("Age_Cat" = "age", "Race_Origin" = "race", "Sex" = "sex")) %>% left_join(as.data.frame(plot_data_pancreas75[,c(1,2,3,12)]), by = c("Age_Cat" = "age", "Race_Origin" = "race", "Sex" = "sex")) %>% left_join(as.data.frame(plot_data_pancreas100[,c(1,2,3,12)]), by = c("Age_Cat" = "age", "Race_Origin" = "race", "Sex" = "sex")) %>% drop_na()

colnames(pancreas_data_survival)[34] <- "estimate_unscreened"
colnames(pancreas_data_survival)[35] <- "estimate_screened_all_25"
colnames(pancreas_data_survival)[36] <- "estimate_screened_all_50"
colnames(pancreas_data_survival)[37] <- "estimate_screened_all_75"
colnames(pancreas_data_survival)[38] <- "estimate_screened_all_100"

#calculate screen gains by adding survival with the estimate to get expected lifetime
pancreas_data_survival$Survival_Months_Gained_screened_all_25 <- pancreas_data_survival$new_survival + pancreas_data_survival$estimate_screened_all_25

pancreas_data_survival$Survival_Months_Gained_screened_all_50 <- pancreas_data_survival$new_survival + pancreas_data_survival$estimate_screened_all_50

pancreas_data_survival$Survival_Months_Gained_screened_all_75 <- pancreas_data_survival$new_survival + pancreas_data_survival$estimate_screened_all_75

pancreas_data_survival$Survival_Months_Gained_screened_all_100 <- pancreas_data_survival$new_survival + pancreas_data_survival$estimate_screened_all_100

#calculate survival data  (divide by 12 to go from months to years)
pancreas_survival_unscreened <- survfit(Surv(new_survival/12, status) ~ 1, data = pancreas_data_survival)
pancreas_survival_screened_all_25 <- survfit(Surv(Survival_Months_Gained_screened_all_25/12, status) ~ 1, data = pancreas_data_survival)
pancreas_survival_screened_all_50 <- survfit(Surv(Survival_Months_Gained_screened_all_50/12, status) ~ 1, data = pancreas_data_survival)
pancreas_survival_screened_all_75 <- survfit(Surv(Survival_Months_Gained_screened_all_75/12, status) ~ 1, data = pancreas_data_survival)
pancreas_survival_screened_all_100 <- survfit(Surv(Survival_Months_Gained_screened_all_100/12, status) ~ 1, data = pancreas_data_survival)

#fit the data for survival curves
fit_pancreas <- list("Unscreened" = pancreas_survival_unscreened, "Screened (25% Effectiveness)" = pancreas_survival_screened_all_25, "Screened (50% Effectiveness)" = pancreas_survival_screened_all_50, "Screened (75% Effectiveness)" = pancreas_survival_screened_all_75, "Screened (100% Effectiveness)" = pancreas_survival_screened_all_100)
```

```{r, fig.width = 10}
ggsurvplot(fit_pancreas, data = pancreas_data_survival, combine = TRUE, # Combine curves
           risk.table = FALSE,                  
           conf.int = TRUE,                    # Add confidence interval
           censor = FALSE,                     # Remove censor points
           tables.theme = theme_cleantable(),  # Clean risk table
           palette = c("red", "orange", "yellow", "green", "blue"),
           ggtheme = theme_light(),
           size = 2,
           legend = c(0.8, 0.8),
           legend.title="Screening Status:",
           legend.lab=c("Unscreened", "Screened (25% Effectiveness)", "Screened (50% Effectiveness)", "Screened (75% Effectiveness)", "Screened (100% Effectiveness)"),
           font.x = c(28),
           font.y = c(28),
           font.tickslab = c(28),
           font.legend = c(28),
           xlab = "Years", 
           ylab = "Survival Probability"#,
           )
```

RIDGE PLOT

```{r, fig.width = 10}
colors <- c("Unscreened" = "red", "Screened (25% Effectiveness)" = "orange", "Screened (50% Effectiveness)" = "yellow", "Screened (75% Effectiveness)" = "green", "Screened (100% Effectiveness)" = "blue")
ridge_data <- pancreas_data_survival %>% filter(Race_Origin == "African American", Sex == "Male")
ggplot()+
  geom_density_ridges(data = ridge_data, aes(y = Age_Cat, x = new_survival/12, fill = "Unscreened"), alpha = 0.5, scale = 1)+
  geom_density_ridges(data = ridge_data, aes(y = Age_Cat, x = Survival_Months_Gained_screened_all_25/12, fill = "Screened (25% Effectiveness)"), alpha = 0.5, scale = 1)+
  geom_density_ridges(data = ridge_data, aes(y = Age_Cat, x = Survival_Months_Gained_screened_all_50/12, fill = "Screened (50% Effectiveness)"), alpha = 0.5, scale = 1)+
  geom_density_ridges(data = ridge_data, aes(y = Age_Cat, x = Survival_Months_Gained_screened_all_75/12, fill = "Screened (75% Effectiveness)"), alpha = 0.5, scale = 1)+
  geom_density_ridges(data = ridge_data, aes(y = Age_Cat, x = Survival_Months_Gained_screened_all_100/12, fill = "Screened (100% Effectiveness)"), alpha = 0.5, scale = 1)+
  xlab("Survival (Years)")+
  ylab("Age")+
  ggtitle("African American Men")+
  labs(fill = "Screening Status:")+
  scale_fill_manual(values = colors, breaks=c("Unscreened","Screened (25% Effectiveness)","Screened (50% Effectiveness)", "Screened (75% Effectiveness)", "Screened (100% Effectiveness)"))+
  theme_light()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size = 20),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        strip.text = element_text(size = 26),
        legend.position = "bottom",
        legend.text = element_text(size = 16),
        legend.title = element_text(size = 16),
        title = element_text(size = 28))
```

DUMBBELL PLOT

```{r, fig.width = 10}
ggplot(pancreas_data_survival %>% filter(Race_Origin == "Hispanic", Sex == "Female"), aes(x=estimate_unscreened/12, xend=estimate_screened_all_100/12, y=Age_Cat, group=Age_Cat)) + 
        geom_dumbbell(color="#a3c4dc", 
                      size=2, 
                      size_x=5,
                      size_xend=5,
                      colour_xend ="#0e668b")+
  xlab("Overall Survival With and Without Screening in Years")+
  ylab("Age")+
  ggtitle("Hispanic Women")+
  theme_light()+
  theme(axis.text.x = element_text(, vjust = 0.5, hjust=1, size = 28),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        strip.text = element_text(size = 26),
        legend.position = "bottom",
        legend.text = element_text(size = 16),
        legend.title = element_text(size = 16),
        title = element_text(size = 28))
```

LINE PLOT (75% Effectiveness)

```{r, fig.width = 10}
ggplot(plot_data_pancreas75, aes(x=age, y = estimate/12, color=race))+
  geom_line(aes(group=race), size = 2, alpha = 0.75)+
  geom_point(aes(size=sample_size), alpha = 0.5)+
  scale_size(name = "Sample Size", range = c(5, 20))+
  scale_color_manual(name = "Ancestry", values=c("#009E73", "#56B4E9", "#F0E442", "#E69F00", "#0072B2", "#D55E00", "#CC79A7"))+
  facet_wrap(~sex)+
  ylab("Expected Residual Lifetime Gained (Years)")+
  xlab("Age")+
  theme_light()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size = 24),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        strip.text = element_text(size = 28),
        legend.text = element_text(size = 28),
        legend.title = element_text(size = 28),
        title = element_text(size = 28))
```

SOURCE FOR CATEGORY POPULATION DATA
https://www.census.gov/data/tables/time-series/demo/popest/2010s-national-detail.html
Annual Estimates of the Resident Population for Selected Age Groups by Sex: April 1, 2010 to July 1, 2019

Stategy plot

```{r}
strategy_pancreas2 <- as.data.frame(matrix(0, 9, 2))
colnames(strategy_pancreas2)<-c("Lifetime", "Strategy")
#take the average expected lifetime, multiply it by the number of people with pancreas cancer divided by the population of the united states 
strategy_pancreas2[1,1]<-mean(pancreas_data_survival$estimate_screened_all_75)*nrow(pancreas_data_survival %>% filter(Year_Diagnosis == 2010))/(174283902)

#same as before but this time subset to a specific race
strategy_pancreas2[2,1]<-mean((pancreas_data_survival %>% filter(Race_Origin == "Hispanic") %>% filter(Age_Diagnosis >= 55))$estimate_screened_all_75)*nrow(pancreas_data_survival %>% filter(Race_Origin == "Hispanic") %>% filter(Age_Diagnosis >= 55) %>% filter(Year_Diagnosis == 2010))/(5724831)

strategy_pancreas2[3,1]<-mean((pancreas_data_survival %>% filter(Race_Origin == "Hispanic") %>% filter(Age_Diagnosis < 55))$estimate_screened_all_75)*nrow(pancreas_data_survival %>% filter(Race_Origin == "Hispanic") %>% filter(Age_Diagnosis < 55) %>% filter(Year_Diagnosis == 2010))/(16886751)

strategy_pancreas2[4,1]<-mean((pancreas_data_survival %>% filter(Race_Origin == "Caucasian") %>% filter(Age_Diagnosis >= 55))$estimate_screened_all_75)*nrow(pancreas_data_survival %>% filter(Race_Origin == "Caucasian") %>% filter(Age_Diagnosis >= 55) %>% filter(Year_Diagnosis == 2010))/(54891829)

strategy_pancreas2[5,1]<-mean((pancreas_data_survival %>% filter(Race_Origin == "Caucasian") %>% filter(Age_Diagnosis < 55))$estimate_screened_all_75)*nrow(pancreas_data_survival %>% filter(Race_Origin == "Caucasian") %>% filter(Age_Diagnosis < 55) %>% filter(Year_Diagnosis == 2010))/(68000019)

strategy_pancreas2[6,1]<-mean((pancreas_data_survival %>% filter(Race_Origin == "African American") %>% filter(Age_Diagnosis >= 55))$estimate_screened_all_75)*nrow(pancreas_data_survival %>% filter(Race_Origin == "African American") %>% filter(Age_Diagnosis >= 55) %>% filter(Year_Diagnosis == 2010))/(6843792)

strategy_pancreas2[7,1]<-mean((pancreas_data_survival %>% filter(Race_Origin == "African American") %>% filter(Age_Diagnosis < 55))$estimate_screened_all_75)*nrow(pancreas_data_survival %>% filter(Race_Origin == "African American") %>% filter(Age_Diagnosis < 55) %>% filter(Year_Diagnosis == 2010))/(13145040)

strategy_pancreas2[8,1]<-mean((pancreas_data_survival %>% filter(Race_Origin == "Asian or Pacific Islander") %>% filter(Age_Diagnosis >= 55))$estimate_screened_all_75)*nrow(pancreas_data_survival %>% filter(Race_Origin == "Asian or Pacific Islander") %>% filter(Age_Diagnosis >= 55) %>% filter(Year_Diagnosis == 2010))/(2861883)

strategy_pancreas2[9,1]<-mean((pancreas_data_survival %>% filter(Race_Origin == "Asian or Pacific Islander") %>% filter(Age_Diagnosis < 55))$estimate_screened_all_75)*nrow(pancreas_data_survival %>% filter(Race_Origin == "Asian or Pacific Islander") %>% filter(Age_Diagnosis < 55) %>% filter(Year_Diagnosis == 2010))/(5929757)

strategy_pancreas2[1,2]<-c("All")
strategy_pancreas2[2,2]<-c("Hispanics 55+")
strategy_pancreas2[3,2]<-c("Hispanics Under 55")
strategy_pancreas2[4,2]<-c("Caucasians 55+")
strategy_pancreas2[5,2]<-c("Caucasians Under 55")
strategy_pancreas2[6,2]<-c("African Americans 55+")
strategy_pancreas2[7,2]<-c("African Americans Under 55")
strategy_pancreas2[8,2]<-c("Asian or Pacific Islanders 55+")
strategy_pancreas2[9,2]<-c("Asian or Pacific Islanders Under 55")
```

```{r, fig.width = 10}
ggplot(strategy_pancreas2)+
  geom_col(aes(reorder(Strategy, -Lifetime, sum), (Lifetime/12)*365, fill = Strategy), color = "black")+
  scale_fill_manual(values=c("#009E73", "#999999", "#56B4E9", "#F0E442", "#0072B2", "#E69F00", "#D55E00", "#CC79A7", "#000000"), breaks=c("Asian or Pacific Islanders 55+", "Hispanics 55+", "African Americans 55+", "Caucasians 55+", "All", "African Americans Under 55", "Asian or Pacific Islanders Under 55", "Hispanics Under 55", "Caucasians Under 55"))+
  ylab("Mean Survival Time Per Screen (Days)")+
  xlab("Early Screening Strategies")+
  theme_light()+
    theme(axis.text.x = element_blank(),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        strip.text = element_text(size = 28),
        legend.text = element_text(size = 24),
        legend.title = element_blank(),
        title = element_text(size = 28))
```

HEAT MAP

```{r}
#Create a dataset and synthetic data like before but now we have two scales, effectiveness and detection probability. Effectiveness is the likelihood that the treatment after early screening will succeed and provide normal life expectancy. Detection probability is the likelihood that early detection will occur. Otherwise the process is the same as above.

df_pancreas2 <- matrix(0, length(seq(0, 1, by = 0.1))*length(seq(0, 1, by = 0.1)), 3)
t <- 1
for(x in seq(0, 1, by = 0.1))
{
  for(a in seq(0, 1, by = 0.1))
  {
    data_filtered <- df_pancreas %>% filter(Race_Origin == "Caucasian") %>% filter(Age_Cat == "50-54 years") %>% filter(Sex == "Female")
    
    data_filtered$new_survival_early <- data_filtered$new_survival
    for(e in 1:nrow(data_filtered))
    {
      u1 <- runif(1, 0, 1)
      u2 <- runif(1, 0, 1)
      if(u2 <= x)
      {
        if(u1 <= a)
        {
          if(data_filtered$new_survival[e] <= (81.0*12 - data_filtered$Age_Diagnosis[e]*12))
          {
            data_filtered$new_survival_early[e] <- 81.0*12 - data_filtered$Age_Diagnosis[e]*12
          }
        }
      }
    }
    
    sample_size <- nrow(data_filtered)
    
    diagnosis <- data_filtered %>% 
      count(Year_Diagnosis)
    
    for(y in years)
    {
      if(is.element(y, diagnosis$Year_Diagnosis)==FALSE)
      {
        diagnosis <- rbind(diagnosis, c(y, 0))
        colnames(diagnosis)<-c("Year_Diagnosis", "n")
      }
    }
    
    diagnosis <- diagnosis[order(diagnosis$Year_Diagnosis),] 
    
    h <- mean(diagnosis$n)
    
    m2 <- 1/(mean(data_filtered$new_survival, na.rm = TRUE))
      
      if(is.nan(m2) ==TRUE | is.na(m2)==TRUE)
      {
        m2 <- 0
      }
      
      m3 <- 1/(mean(data_filtered$new_survival_early, na.rm = TRUE))
      
      if(is.nan(m3) ==TRUE | is.na(m3)==TRUE)
      {
        m3 <- 0
      }
      
      m1 <- 1/6

      r12 <- 0.9
      r10 <- 1 - r12
      
      m10 <- r10*m1
      m12 <- r12*m1
      
      survival_time <- mean(data_filtered$Survival_Months)
      
      estimate <- (1/(m10+m12)+m12/(m3*(m10+m12))) -  (1/(m10+m12)+m12/(m2*(m10+m12)))
    
    df_pancreas2[t, 1] <- x
    df_pancreas2[t, 2] <- a
    df_pancreas2[t, 3] <- estimate
    t <- t + 1
  }
}
```

```{r, fig.width = 10}
ggplot(as.data.frame(df_pancreas2), aes(x = V1, y = V2, fill = V3/12))+
  geom_tile()+
  xlab("Detection Probability")+
  ylab("Treatment Effectiveness")+
  #ggtitle("Expected Residual Lifetime Gained Based on Detection Probability and Early Treatment Effectiveness")+
  ggtitle("Caucasian Women, 50-54")+
  theme_light()+
  theme(axis.text.x = element_text(vjust = 0.5, hjust=1, size = 24),
        strip.text = element_text(size = 20),
        axis.title = element_text( size = 28),
        axis.text.y = element_text(size = 24),
        axis.title.x = element_text(vjust = -0.5),
        axis.title.y = element_text(hjust = 0.5),
        legend.text = element_text(size = 16),
        legend.title = element_text(size = 20),
        title = element_text(size = 28))+
  labs(fill='Expected Residual Lifetime Gained (Years)') 
```

CONTOUR PLOT

```{r}
#methodology is the same as with the heat map but using a different group
df_pancreas3 <- matrix(0, length(seq(0, 1, by = 0.01))*length(seq(0, 1, by = 0.1)), 3)
x_i <- 1
for(x in seq(0, 1, by = 0.1))
{
  for(a in seq(0, 1, by = 0.01))
  {
    data_filtered <- df_pancreas %>% filter(Race_Origin == "African American") %>% filter(Age_Cat == "65-69 years") %>% filter(Sex == "Male")
    
    data_filtered$new_survival_early <- data_filtered$new_survival
    for(e in 1:nrow(data_filtered))
    {
      u1 <- runif(1, 0, 1)
      u2 <- runif(1, 0, 1)
      if(u2 <= a)
      {
        if(u1 <= x)
        {
          if(data_filtered$new_survival[e] <= (87.7*12 - data_filtered$Age_Diagnosis[e]*12))
          {
            data_filtered$new_survival_early[e] <- 87.7*12 - data_filtered$Age_Diagnosis[e]*12
          }
        }
      }
    }
    
    sample_size <- nrow(data_filtered)
    
    diagnosis <- data_filtered %>% 
      count(Year_Diagnosis)
    
    for(y in years)
    {
      if(is.element(y, diagnosis$Year_Diagnosis)==FALSE)
      {
        diagnosis <- rbind(diagnosis, c(y, 0))
        colnames(diagnosis)<-c("Year_Diagnosis", "n")
      }
    }
    
    diagnosis <- diagnosis[order(diagnosis$Year_Diagnosis),] 
    
    h <- mean(diagnosis$n)
      
      m2 <- 1/(mean(data_filtered$new_survival, na.rm = TRUE))
      
      if(is.nan(m2) ==TRUE | is.na(m2)==TRUE)
      {
        m2 <- 0
      }
      
      m3 <- 1/(mean(data_filtered$new_survival_early, na.rm = TRUE))
      
      if(is.nan(m3) ==TRUE | is.na(m3)==TRUE)
      {
        m3 <- 0
      }
      
      m1 <- 1/6

      r12 <- 0.9
      r10 <- 1 - r12
      
      m10 <- r10*m1
      m12 <- r12*m1
      
      survival_time <- mean(data_filtered$Survival_Months)
      
      estimate <- (1/(m10+m12)+m12/(m3*(m10+m12))) -  (1/(m10+m12)+m12/(m2*(m10+m12)))
  
  df_pancreas3[x_i, 1] <- x
  df_pancreas3[x_i, 2] <- a
  df_pancreas3[x_i, 3] <- estimate
  x_i <- x_i + 1
  }
}
```

```{r, fig.width = 10}
ggplot(as.data.frame(df_pancreas3))+
  geom_smooth(aes(x = V2, y = V3/12, group = V1, color = V1))+
  xlab("Probability of Early Detection")+
  ylab("Expected Residual Lifetime Gained (Years)")+
  labs(color = "Treatment Effectiveness")+
  scale_colour_gradient(
  low = "red",
  high = "blue"
)+
  theme_light()+
  ggtitle("African American Men, 65-69")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size = 24),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        strip.text = element_text(size = 28),
        legend.text = element_text(size = 28),
        legend.title = element_text(size = 28),
        title = element_text(size = 28))
```

INCIDENCE PLOT

```{r, fig.width=10}
incidence <- pancreas_data_survival %>% count(Age_Cat, Race_Origin, Sex, Year_Diagnosis)

ggplot(incidence %>% filter(Race_Origin == "Caucasian") %>% filter(Sex == "Male"), aes(y = n, x = Year_Diagnosis))+
  geom_line(aes(color = Age_Cat), alpha = 0.5, size = 2)+
   ylab("Incidence of Pancreatic Cancer")+
  xlab("Year")+
  ggtitle("Incidence of Pancreatic Cancer Amongst Caucasian Men")+
  theme_light()+
  theme(title = element_text(size = 32),
        axis.text.x = element_text(vjust = 0.5, hjust=1, size = 24),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        legend.text = element_text(size = 32),
        legend.title = element_text(size = 32),
        legend.position = "bottom")

ggplot(incidence %>% filter(Race_Origin == "Caucasian") %>% filter(Sex == "Female"), aes(y = n, x = Year_Diagnosis))+
  geom_line(aes(color = Age_Cat), alpha = 0.5, size = 2)+
   ylab("Incidence of Pancreatic Cancer")+
  xlab("Year")+
  ggtitle("Incidence of Pancreatic Cancer Amongst Caucasian Women")+
  theme_light()+
  theme(title = element_text(size = 32),
        axis.text.x = element_text(vjust = 0.5, hjust=1, size = 24),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        legend.text = element_text(size = 32),
        legend.title = element_text(size = 32),
        legend.position = "bottom")

ggplot(incidence %>% filter(Race_Origin == "Hispanic") %>% filter(Sex == "Male"), aes(y = n, x = Year_Diagnosis))+
  geom_line(aes(color = Age_Cat), alpha = 0.5, size = 2)+
   ylab("Incidence of Pancreatic Cancer")+
  xlab("Year")+
  ggtitle("Incidence of Pancreatic Cancer Amongst Hispanic Men")+
  theme_light()+
  theme(title = element_text(size = 32),
        axis.text.x = element_text(vjust = 0.5, hjust=1, size = 24),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        legend.text = element_text(size = 32),
        legend.title = element_text(size = 32),
        legend.position = "bottom")

ggplot(incidence %>% filter(Race_Origin == "Hispanic") %>% filter(Sex == "Female"), aes(y = n, x = Year_Diagnosis))+
  geom_line(aes(color = Age_Cat), alpha = 0.5, size = 2)+
   ylab("Incidence of Pancreatic Cancer")+
  xlab("Year")+
  ggtitle("Incidence of Pancreatic Cancer Amongst Hispanic Women")+
  theme_light()+
  theme(title = element_text(size = 32),
        axis.text.x = element_text(vjust = 0.5, hjust=1, size = 24),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        legend.text = element_text(size = 32),
        legend.title = element_text(size = 32),
        legend.position = "bottom")

ggplot(incidence %>% filter(Race_Origin == "African American") %>% filter(Sex == "Male"), aes(y = n, x = Year_Diagnosis))+
  geom_line(aes(color = Age_Cat), alpha = 0.5, size = 2)+
   ylab("Incidence of Pancreatic Cancer")+
  xlab("Year")+
  ggtitle("Incidence of Pancreatic Cancer Amongst African American Men")+
  theme_light()+
  theme(title = element_text(size = 32),
        axis.text.x = element_text(vjust = 0.5, hjust=1, size = 24),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        legend.text = element_text(size = 32),
        legend.title = element_text(size = 32),
        legend.position = "bottom")

ggplot(incidence %>% filter(Race_Origin == "African American") %>% filter(Sex == "Female"), aes(y = n, x = Year_Diagnosis))+
  geom_line(aes(color = Age_Cat), alpha = 0.5, size = 2)+
   ylab("Incidence of Pancreatic Cancer")+
  xlab("Year")+
  ggtitle("Incidence of Pancreatic Cancer Amongst African American Women")+
  theme_light()+
  theme(title = element_text(size = 32),
        axis.text.x = element_text(vjust = 0.5, hjust=1, size = 24),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        legend.text = element_text(size = 32),
        legend.title = element_text(size = 32),
        legend.position = "bottom")

ggplot(incidence %>% filter(Race_Origin == "Asian or Pacific Islander") %>% filter(Sex == "Male"), aes(y = n, x = Year_Diagnosis))+
  geom_line(aes(color = Age_Cat), alpha = 0.5, size = 2)+
   ylab("Incidence of Pancreatic Cancer")+
  xlab("Year")+
  ggtitle("Incidence of Pancreatic Cancer Amongst Asian or Pacific Islander Men")+
  theme_light()+
  theme(title = element_text(size = 32),
        axis.text.x = element_text(vjust = 0.5, hjust=1, size = 24),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        legend.text = element_text(size = 32),
        legend.title = element_text(size = 32),
        legend.position = "bottom")

ggplot(incidence %>% filter(Race_Origin == "Asian or Pacific Islander") %>% filter(Sex == "Female"), aes(y = n, x = Year_Diagnosis))+
  geom_line(aes(color = Age_Cat), alpha = 0.5, size = 2)+
   ylab("Incidence of Pancreatic Cancer")+
  xlab("Year")+
  ggtitle("Incidence of Pancreatic Cancer Amongst Asian or Pacific Islander Women")+
  theme_light()+
  theme(title = element_text(size = 32),
        axis.text.x = element_text(vjust = 0.5, hjust=1, size = 24),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        legend.text = element_text(size = 32),
        legend.title = element_text(size = 32),
        legend.position = "bottom")
```

SPECIFICITY

```{r}
#Visualize how a change in specificity would affect the estimate

# a. Average # of white males 55-59 8366815
# b. Number of people in that group with pancreatic cancer: multiply seer # by 5 (seer has a fifth of the data)
# 365*5 = 1825
# c. Pick a number that is the expected lifetime of a false positive (lose 3% (arbitrary/parameter of model) of life expectancy of that group)
# d. Range of false pos probs (0.0 to 0.001)
# e. Change first term of estimate to ((1/(m10+m12)+m12/(m3*(m10+m12))) - (1/(m10+m12)+m12/(m2*(m10+m12))))*1825 - lifetime lost from false positives
# f. lifetime lost from false positives = (a-b)*d*c*expected residual lifetime
# expected lifetime = 76.1, residual = 76.1 - 52.5 = 23.6

df_pancreas4 <- matrix(0, length(seq(0, 0.1, by = 0.01)), 2)
x_i <- 1
for(i in seq(0, 0.001, by = 0.0001))
{
  df_pancreas4[x_i, 1] <- i
  df_pancreas4[x_i, 2] <- 141.96129*1825 - (8366815-1825)*i*0.03*23.6*12 # 23.6 = 76.1 - average of 55-59
  x_i <- x_i + 1
}
specificity_data <- as.data.frame(df_pancreas4)
```

```{r, fig.width = 8}
ggplot(specificity_data)+
  geom_col(aes(V1*100, V2/8366815*30, fill = V2/8366815*30), color = "black")+
  ylab("Average Net Survival Benefit Per Screen (Days)")+
  xlab("False Positive Probability")+
  ggtitle("Caucasian Men, 55-59")+
  theme_light()+
    theme(axis.text.x = element_text(size = 28),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        strip.text = element_text(size = 28),
        legend.position = "none",
        title = element_text(size = 28))
```

MORTALITY

```{r}
#visualize how a change in mortality would affect the estimate

  #Mortality
  ### add uniform between 0 and 1 to transform m3 ###
  ### for each person ###
  ### if uni < p then new_survival_early = really low (i.e 6 months), else stays same ###
  ### bar plot (one subgroup)
  ### p = 0.01, 0.02 , ... , 0.1 

df_pancreas5 <- matrix(0, length(seq(0, 0.001, by = 0.0001)), 5)
x_i <- 1
for(p in seq(0, 0.001, by = 0.0001)) #probability of treatment induced mortality (mortality = 1 month)
{
  data_filtered <- df_pancreas %>% filter(Race_Origin == "African American") %>% filter(Age_Cat == "55-59 years") %>% filter(Sex == "Female")
  
  data_filtered$new_survival_early <- data_filtered$new_survival
  set.seed(123)
  for(e in 1:nrow(data_filtered))
  {
    u1 <- runif(1, 0, 1)
    u2 <- runif(1, 0, 1)
    if(u1 <= 0.75)
    {
      if(data_filtered$new_survival[e] <= (77.9*12 - data_filtered$Age_Diagnosis[e]*12))
      {
        data_filtered$new_survival_early[e] <- 77.9*12 - data_filtered$Age_Diagnosis[e]*12
      }
    }
  }
  
  sample_size <- nrow(data_filtered)
  
  diagnosis <- data_filtered %>% 
    count(Year_Diagnosis)
  
  for(y in years)
  {
    if(is.element(y, diagnosis$Year_Diagnosis)==FALSE)
    {
      diagnosis <- rbind(diagnosis, c(y, 0))
      colnames(diagnosis)<-c("Year_Diagnosis", "n")
    }
  }
  diagnosis <- diagnosis[order(diagnosis$Year_Diagnosis),] 
  
  h <- mean(diagnosis$n)
  
  m2 <- 1/(mean(data_filtered$new_survival, na.rm = TRUE))
  
  if(is.nan(m2) ==TRUE | is.na(m2)==TRUE)
  {
    m2 <- 0
  }
  
  
  m3 <- 1/(mean(data_filtered$new_survival_early, na.rm = TRUE))
  
  if(is.nan(m3) ==TRUE | is.na(m3)==TRUE)
  {
    m3 <- 0
  }
  
  m3_mort <- (1-p)*m3+p*1
  
  
  if(is.nan(m3_mort) ==TRUE | is.na(m3_mort)==TRUE)
  {
    m3_mort <- 0
  }
  
  m1 <- 1/6
  
  r12 <- 0.9
  r10 <- 1 - r12
  
  m10 <- r10*m1
  m12 <- r12*m1
  
  survival_time <- mean(data_filtered$Survival_Months)
  
  estimate <- (1/(m10+m12)+m12/(m3*(m10+m12))) -  (1/(m10+m12)+m12/(m2*(m10+m12)))
  estimate2 <- (1/(m10+m12)+m12/(m3_mort*(m10+m12))) -  (1/(m10+m12)+m12/(m2*(m10+m12)))
  
  df_pancreas5[x_i, 1] <- p
  df_pancreas5[x_i, 2] <- estimate
  df_pancreas5[x_i, 3] <- estimate2
  df_pancreas5[x_i, 4] <- m3
  df_pancreas5[x_i, 5] <- m3_mort
  x_i <- x_i + 1
}
```

```{r, fig.width = 10}
ggplot(as.data.frame(df_pancreas5))+
  geom_col(aes(V1*100, V3/12, fill = V3/12), color = "black")+
  ylab("Expected Residual Lifetime Gained (Years)")+
  xlab("Chance of Mortality (%)")+
  ggtitle("African American Women, 55-59")+
  theme_light()+
    theme(axis.text.x = element_text(size = 28),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        strip.text = element_text(size = 28),
        legend.position = "none",
        title = element_text(size = 28))
```

MORBIDITY

```{r}
#visualize how a change in morbidity affects the estimate
df_pancreas6 <- matrix(0, nrow(plot_data_pancreas75)*length(seq(0.8, 1, by = 0.05)), 5)
x_i <- 1
for(i in 1:nrow(plot_data_pancreas75))
{
  for(j in seq(0.8, 1, by = 0.05))
  {
    estimate <- (1/(plot_data_pancreas75$m10[i]+plot_data_pancreas75$m12[i])+plot_data_pancreas75$m12[i]/(plot_data_pancreas75$m3[i]*(plot_data_pancreas75$m10[i]+plot_data_pancreas75$m12[i])))*j -  (1/(plot_data_pancreas75$m10[i]+plot_data_pancreas75$m12[i])+plot_data_pancreas75$m12[i]/(plot_data_pancreas75$m2[i]*(plot_data_pancreas75$m10[i]+plot_data_pancreas75$m12[i])))
    df6_pancreas[x_i, 1] <- plot_data_pancreas75$age[i]
    df6_pancreas[x_i, 2] <- plot_data_pancreas75$race[i]
    df6_pancreas[x_i, 3] <- plot_data_pancreas75$sex[i]
    df6_pancreas[x_i, 4] <- j
    df6_pancreas[x_i, 5] <- estimate
    x_i <- x_i + 1
  }
}
morbidity_data <- as.data.frame(df_pancreas6)
```

```{r, fig.width = 10}
ggplot(morbidity_data %>% filter(V2 == "Asian or Pacific Islander") %>% filter(V3 == "Male"), aes(x=V1, y = as.numeric(V5)/12, color=reorder(V4, -as.numeric(V4), sum)))+
  geom_line(aes(group=V4), size = 2, alpha = 0.75)+
  ylab("Expected Gain in QALYs")+
  xlab("Age")+
  labs(color='QALY Factor')+
  ggtitle("Asian or Pacific Islander Men")+
  theme_light()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, size = 24),
        axis.text.y = element_text(size = 28),
        axis.title = element_text( size = 28),
        axis.title.y = element_text(hjust = 0.5),
        strip.text = element_text(size = 28),
        legend.text = element_text(size = 28),
        legend.title = element_text(size = 28),
        title = element_text(size = 28))
```

THIS CHECKS SOME OF OUR ASSUMPTIONS

```{r, message=FALSE, warning=FALSE}
#To check assumptions we use the model with original seer data with no modifications

plot_data_pancreas_assumptions <- data.frame(matrix(ncol = 18, nrow = length(race)*length(age)*length(sex)))
colnames(plot_data_pancreas_assumptions) <- c("race", "age", "sex", "h", "N1", "N2", "m10", "m12", "m1", "m2", "r10", "r12", "estimate", "survival_months", "h_p_value", "N1_p_value", "N2_p_value", "sample_size")

#store data for assumptions in here
h_data <- data.frame(matrix(ncol = 6, nrow = 1))
N1_data <- data.frame(matrix(ncol = 6, nrow = 1))
N2_data <- data.frame(matrix(ncol = 6, nrow = 1))

l = 1
for(i in race)
{
  for(j in age)
  {
    for(k in sex)
    {
      data_filtered <- df_pancreas %>% 
        filter(Race_Origin == i) %>% 
        filter(Age_Cat == j) %>% filter(Sex == k)
      
      sample_size <- nrow(data_filtered)
      
      diagnosis <- data_filtered %>% 
        count(Year_Diagnosis)
      
      surgery <- data_filtered %>% 
        filter(Surgery == "Yes") %>% 
        count(Year_Diagnosis)
      
      no_surgery <- data_filtered %>% 
        filter(Surgery == "No") %>% count(Year_Diagnosis)
      
      surgery_death <- data_filtered %>% 
        filter(Surgery == "Yes") %>% 
        filter(Vital_Status == "Dead") %>% 
        filter(Age_Death_Cat == j) %>% 
        count(Year_Diagnosis)
      
      no_surgery_death <- data_filtered %>% 
        filter(Surgery == "No") %>% 
        filter(Vital_Status == "Dead") %>% 
        filter(Age_Death_Cat == j) %>% 
        count(Year_Diagnosis)
      
      for(y in years)
      {
        if(is.element(y, diagnosis$Year_Diagnosis)==FALSE)
        {
          diagnosis <- rbind(diagnosis, c(y, 0))
          colnames(diagnosis)<-c("Year_Diagnosis", "n")
        }
        if(is.element(y, surgery$Year_Diagnosis)==FALSE)
        {
          surgery <- rbind(surgery, c(y, 0))
          colnames(surgery)<-c("Year_Diagnosis", "n")
        }
        if(is.element(y, no_surgery$Year_Diagnosis)==FALSE)
        {
          no_surgery <- rbind(no_surgery, c(y, 0))
          colnames(no_surgery)<-c("Year_Diagnosis", "n")
        }
        if(is.element(y, surgery_death$Year_Diagnosis)==FALSE)
        {
          surgery_death <- rbind(surgery_death, c(y, 0))
          colnames(surgery_death)<-c("Year_Diagnosis", "n")
        }
        if(is.element(y, no_surgery_death$Year_Diagnosis)==FALSE)
        {
          no_surgery_death <- rbind(no_surgery_death, c(y, 0))
          colnames(no_surgery_death)<-c("Year_Diagnosis", "n")
        }
      }
      
      diagnosis <- diagnosis[order(diagnosis$Year_Diagnosis),] 
      surgery <- surgery[order(surgery$Year_Diagnosis),] 
      no_surgery <- no_surgery[order(no_surgery$Year_Diagnosis),] 
      surgery_death <- surgery_death[order(surgery_death$Year_Diagnosis),] 
      no_surgery_death <- no_surgery_death[order(no_surgery_death$Year_Diagnosis),] 
      
      h <- mean(diagnosis$n)
      
      #For this model we care that individuals stay in their age category for the entire model, so we must check that age cat and age daeth cat       are equal
      m10_dead_cases_in_age <- data_filtered %>% 
        filter(Surgery == "No") %>% 
        filter(Vital_Status == "Dead") %>% 
        filter(Age_Death_Cat == j)
      
      m10_dead_cases_out_age <- data_filtered %>% 
        filter(Surgery == "No") %>% 
        filter(Vital_Status == "Dead") %>% 
        filter(Age_Death_Cat != j)
      
      if(nrow(m10_dead_cases_out_age)!=0)
      {
        m10_dead_cases_out_age$Survival_Months <- m10_dead_cases_out_age$month_cutoff-m10_dead_cases_out_age$Age_Diagnosis_In_Months
      }
      
      m10_alive_cases_out_age <- data_filtered %>% 
        filter(Surgery == "No") %>% 
        filter(Vital_Status == "Alive") %>% 
        filter(Age_Diagnosis_In_Months + Survival_Months >= month_cutoff)
      
      if(nrow(m10_alive_cases_out_age)!=0)
      {
        m10_alive_cases_out_age$Survival_Months <- m10_alive_cases_out_age$month_cutoff-m10_alive_cases_out_age$Age_Diagnosis_In_Months
      }
      
      m10_cases <- rbind(m10_dead_cases_in_age, rbind(m10_dead_cases_out_age, m10_alive_cases_out_age))
      
      m10 <- 1/(mean(m10_cases$Survival_Months))
      
      if(is.nan(m10) ==TRUE | is.na(m10)==TRUE)
      {
        m10 <- 0
      }
      
      m2_dead_cases_in_age <- data_filtered %>% 
        filter(Surgery == "Yes") %>% 
        filter(Vital_Status == "Dead") %>% 
        filter(Age_Death_Cat == j)
      
      m2_dead_cases_out_age <- data_filtered %>% 
        filter(Surgery == "Yes") %>% 
        filter(Vital_Status == "Dead") %>% 
        filter(Age_Death_Cat != j)
      
      if(nrow(m2_dead_cases_out_age)!=0)
      {
        m2_dead_cases_out_age$Survival_Months <- m2_dead_cases_out_age$month_cutoff-m2_dead_cases_out_age$Age_Diagnosis_In_Months
      }
      
      m2_alive_cases_out_age <- data_filtered %>% 
        filter(Surgery == "Yes") %>%
        filter(Vital_Status == "Alive") %>% 
        filter(Age_Diagnosis_In_Months + Survival_Months >= month_cutoff)
      
      if(nrow(m2_alive_cases_out_age)!=0)
      {
        m2_alive_cases_out_age$Survival_Months <- m2_alive_cases_out_age$month_cutoff-m2_alive_cases_out_age$Age_Diagnosis_In_Months
      }
      
      m2_cases <- rbind(m2_dead_cases_in_age, rbind(m2_dead_cases_out_age, m2_alive_cases_out_age))
      
      m2 <- 1/(mean(m2_cases$Survival_Months))
      
      if(is.nan(m2) ==TRUE | is.na(m2)==TRUE)
      {
        m2 <- 0
      }
      
      r12 <- mean(surgery$n)/mean(diagnosis$n)
      r10 <- 1 - r12
      m12 <- m10/r10 - m10
      
      if(is.nan(m12) ==TRUE | is.na(m12)==TRUE)
      {
        m12 <- 0
      }
      m1 <- m10 + m12
      if(is.nan(m1) ==TRUE | is.na(m1)==TRUE)
      {
        m1 <- 0
      }

      treatment_avg <- mean(m2_cases$Survival_Months)/12
      if(is.nan(treatment_avg)==TRUE)
      {
        treatment_avg <- 0
      }
      
      diagnosis_avg <- (1/m1)/12
      if(is.nan(diagnosis_avg)==TRUE)
      {
        diagnosis_avg <- 0
      }
      
      # these are values we will check assumptions with
      N1_time <- diagnosis
      N1_time$n <- diagnosis$n*diagnosis_avg
      N2_time <- surgery
      N2_time$n <- surgery$n*treatment_avg
      N1 <- (h/12)/m1
      N2 <- r12*(h/12)/m2
 
      survival_time <- mean(data_filtered$Survival_Months)
      
      estimate <- (m12*(m10 - m2))/(m10*m2*(m10+m12))
      
      #check assumptions using kolmogorov smirnov test
       if(is.nan(h) == FALSE & is.na(h) == FALSE)
      {
        ks_test <- ks.test(diagnosis$n, "ppois", h)
        p_val_h <- ks_test$p.value
      }
      
      if(is.nan(h) == TRUE | is.na(h) == TRUE)
        {
        p_val_h <- 0
      }
      
      if(is.nan(N1) == FALSE & is.na(N1) == FALSE)
      {
        ks_test <- ks.test(N1_time$n,"ppois", N1)
        p_val_N1 <- ks_test$p.value
      }
      
      if(is.nan(N1) == TRUE | is.na(N1) == TRUE)
        {
        p_val_N1 <- 0
      }
      
      if(is.nan(N2) == FALSE & is.na(N2) == FALSE)
      {
        ks_test <- ks.test(N2_time$n,"ppois", N2)
        p_val_N2 <- ks_test$p.value
      }
      
      if(is.nan(N2) == TRUE | is.na(N2) == TRUE)
        {
        p_val_N2 <- 0
      }
      
      plot_data_pancreas_assumptions[l,] <- c(i, j, k, h, N1, N2, m10, m12, m1, m2, r10, r12, estimate, survival_time, p_val_h, p_val_N1, p_val_N2, sample_size)
      
      # store data about model parameters for assumption testing
      for(w in 1:nrow(diagnosis))
      {
        h_data<-rbind(h_data, c(i, j, k, h, diagnosis$Year_Diagnosis[w], diagnosis$n[w]))
      }
      
      for(w in 1:nrow(N1_time))
      {
        N1_data<-rbind(N1_data, c(i, j, k, N1, N1_time$Year_Diagnosis[w], N1_time$n[w]))
      }
      
      for(w in 1:nrow(N2_time))
      {
        N2_data<-rbind(N2_data, c(i, j, k, N2, N2_time$Year_Diagnosis[w], N2_time$n[w]))
      }
      
      h_data <- h_data %>% replace_with_na(replace = list(X1 = c("Non-Hispanic Unknown Race"), 
                                                          X4 = c("NaN"), 
                                                          X5 = c("NaN"), 
                                                          X6 = c("NaN")))
      h_data <- h_data %>% drop_na()
      
      N1_data <- N1_data %>% replace_with_na(replace = list(X1 = c("Non-Hispanic Unknown Race"), 
                                                            X4 = c("NaN"), 
                                                            X5 = c("NaN"), 
                                                            X6 = c("NaN")))
      N1_data <- N1_data %>% drop_na()
      
      N2_data <- N2_data %>% replace_with_na(replace = list(X1 = c("Non-Hispanic Unknown Race"), 
                                                            X4 = c("NaN"), 
                                                            X5 = c("NaN"), 
                                                            X6 = c("NaN")))
      N2_data <- N2_data %>% drop_na()
      l = l + 1
    }
  }
}

colnames(h_data) <- c("race", "age", "sex", "h", "year", "n")
colnames(N1_data) <- c("race", "age", "sex", "N1", "year", "n")
colnames(N2_data) <- c("race", "age", "sex", "N2", "year", "n")
h_data$n <- as.numeric(h_data$n)
h_data$year <- as.numeric(h_data$year)
h_data$h <- as.numeric(h_data$h)
N1_data$n <- as.numeric(N1_data$n)
N1_data$year <- as.numeric(N1_data$year)
N1_data$N1 <- as.numeric(N1_data$N1)
N2_data$n <- as.numeric(N2_data$n)
N2_data$year <- as.numeric(N2_data$year)
N2_data$N2 <- as.numeric(N2_data$N2)

plot_data_pancreas_assumptions <- plot_data_pancreas_assumptions %>% replace_with_na(replace = list(race = c("Non-Hispanic Unknown Race"), age = c("85+ years"), h = c("NaN"), N1 = c("NaN"), N2 = c("NaN"), m10 = c("NaN"), m12 = c("NaN"), m1 = c("NaN"), m2 = c("NaN"), estimate = c("NaN", "Inf", "-Inf"), survival_months = c("NaN")))

plot_data_pancreas_assumptions <- plot_data_pancreas_assumptions %>% drop_na()

plot_data_pancreas_assumptions$age_label <- ifelse(plot_data_pancreas_assumptions$age == "00 years", 1, ifelse(plot_data_pancreas_assumptions$age == "01-04 years", 2, ifelse(plot_data_pancreas_assumptions$age == "05-09 years", 3, ifelse(plot_data_pancreas_assumptions$age == "10-14 years", 4, ifelse(plot_data_pancreas_assumptions$age == "15-19 years", 5, ifelse(plot_data_pancreas_assumptions$age == "20-24 years", 6, ifelse(plot_data_pancreas_assumptions$age == "25-29 years", 7, ifelse(plot_data_pancreas_assumptions$age == "30-34 years", 8, ifelse(plot_data_pancreas_assumptions$age == "35-39 years", 9, ifelse(plot_data_pancreas_assumptions$age == "40-44 years", 10, ifelse(plot_data_pancreas_assumptions$age == "45-49 years", 11, ifelse(plot_data_pancreas_assumptions$age == "50-54 years", 12, ifelse(plot_data_pancreas_assumptions$age == "55-59 years", 13, ifelse(plot_data_pancreas_assumptions$age == "60-64 years", 14, ifelse(plot_data_pancreas_assumptions$age == "65-69 years", 15, ifelse(plot_data_pancreas_assumptions$age == "70-74 years", 16, ifelse(plot_data_pancreas_assumptions$age == "75-79 years", 17, ifelse(plot_data_pancreas_assumptions$age == "80-84 years", 18, 19))))))))))))))))))

plot_data_pancreas_assumptions$h <- as.numeric(plot_data_pancreas_assumptions$h)
plot_data_pancreas_assumptions$N1 <- as.numeric(plot_data_pancreas_assumptions$N1)
plot_data_pancreas_assumptions$N2 <- as.numeric(plot_data_pancreas_assumptions$N2)
plot_data_pancreas_assumptions$m10 <- as.numeric(plot_data_pancreas_assumptions$m10)
plot_data_pancreas_assumptions$m12 <- as.numeric(plot_data_pancreas_assumptions$m12)
plot_data_pancreas_assumptions$m1 <- as.numeric(plot_data_pancreas_assumptions$m1)
plot_data_pancreas_assumptions$m2 <- as.numeric(plot_data_pancreas_assumptions$m2)
plot_data_pancreas_assumptions$r10 <- as.numeric(plot_data_pancreas_assumptions$r10)
plot_data_pancreas_assumptions$r12 <- as.numeric(plot_data_pancreas_assumptions$r12)
plot_data_pancreas_assumptions$estimate <- as.numeric(plot_data_pancreas_assumptions$estimate)
plot_data_pancreas_assumptions$survival_months <- as.numeric(plot_data_pancreas_assumptions$survival_months)
plot_data_pancreas_assumptions$h_p_value <- as.numeric(plot_data_pancreas_assumptions$h_p_value)
plot_data_pancreas_assumptions$N1_p_value <- as.numeric(plot_data_pancreas_assumptions$N1_p_value)
plot_data_pancreas_assumptions$N2_p_value <- as.numeric(plot_data_pancreas_assumptions$N2_p_value)
plot_data_pancreas_assumptions$sample_size <- as.numeric(plot_data_pancreas_assumptions$sample_size)

plot_data_pancreas_assumptions <- arrange(plot_data_pancreas_assumptions, age, desc())

plot_data_pancreas_assumptions <- plot_data_pancreas_assumptions %>% filter(sample_size >= 100)
#adjust p-values using bonferroni method
h_p_value_bon <- p.adjust(p = plot_data_pancreas_assumptions$h_p_value, method = "bonferroni")
N1_p_value_bon <- p.adjust(p = plot_data_pancreas_assumptions$N1_p_value, method = "bonferroni")
N2_p_value_bon <- p.adjust(p = plot_data_pancreas_assumptions$N2_p_value, method = "bonferroni")
plot_data_pancreas_assumptions <- cbind(plot_data_pancreas_assumptions, cbind(h_p_value_bon,cbind(N1_p_value_bon, N2_p_value_bon)))
```

NOW CHECK ASSUMPTIONS VISUALLY

```{r, fig.width=10}
#We check the distribution of the data against an empirical distribution to see if they follow a similar shape
h_data <- h_data %>% filter(race != "Non-Hispanic American Indian/Alaska Native")
N1_data <- N1_data %>% filter(race != "Non-Hispanic American Indian/Alaska Native")
N1_data$n <- round(N1_data$n)
N2_data <- N2_data %>% filter(race != "Non-Hispanic American Indian/Alaska Native")

#create data for empirical distribution using a poisson distribution
h_empirical <-matrix(0, 152000, 4)
for(i in 1:152)
{
  emp_race <- h_data$race[(i-1)*17+1]
  emp_age <- h_data$age[(i-1)*17+1]
  emp_sex <- h_data$sex[(i-1)*17+1]
  emp_h <- h_data$h[(i-1)*17+1]
  p <- rpois(1000, emp_h)
  for(j in 1:1000)
  {
    h_empirical[(i-1)*1000+j, 1]<-emp_race
    h_empirical[(i-1)*1000+j, 2]<-emp_age
    h_empirical[(i-1)*1000+j, 3]<-emp_sex
    h_empirical[(i-1)*1000+j, 4]<-p[j]
  }
}
h_empirical<-as.data.frame(h_empirical)
colnames(h_empirical) <- c("race", "age", "sex", "n")
h_empirical$n<-as.numeric(h_empirical$n)

N1_empirical <-matrix(0, 152000, 4)
for(i in 1:152)
{
  emp_race <- N1_data$race[(i-1)*17+1]
  emp_age <- N1_data$age[(i-1)*17+1]
  emp_sex <- N1_data$sex[(i-1)*17+1]
  emp_N1 <- N1_data$N1[(i-1)*17+1]
  p <- rpois(1000, emp_N1)
  for(j in 1:1000)
  {
    N1_empirical[(i-1)*1000+j, 1]<-emp_race
    N1_empirical[(i-1)*1000+j, 2]<-emp_age
    N1_empirical[(i-1)*1000+j, 3]<-emp_sex
    N1_empirical[(i-1)*1000+j, 4]<-p[j]
  }
}
N1_empirical<-as.data.frame(N1_empirical)
colnames(N1_empirical) <- c("race", "age", "sex", "n")
N1_empirical$n<-as.numeric(N1_empirical$n)

N2_empirical <- matrix(0, 152000, 4)
for(i in 1:152)
{
  emp_race <- N2_data$race[(i-1)*17+1]
  emp_age <- N2_data$age[(i-1)*17+1]
  emp_sex <- N2_data$sex[(i-1)*17+1]
  emp_N2 <- N2_data$N2[(i-1)*17+1]
  p <- rpois(1000, emp_N2)
  for(j in 1:1000)
  {
    N2_empirical[(i-1)*1000+j, 1]<-emp_race
    N2_empirical[(i-1)*1000+j, 2]<-emp_age
    N2_empirical[(i-1)*1000+j, 3]<-emp_sex
    N2_empirical[(i-1)*1000+j, 4]<-p[j]
  }
}
N2_empirical<-as.data.frame(N2_empirical)
colnames(N2_empirical) <- c("race", "age", "sex", "n")
N2_empirical$n<-as.numeric(N2_empirical$n)

#combine actual data with emperical data
h_data2 <- h_data %>% drop_na()
h_data2$data <- "Empirical"
h_data2 <- h_data2 %>% filter(age %in% c("00 years", "01-04 years", "05-09 years", "10-14 years", "15-19 years", "20-24 years", "25-29 years", "85+ years") == FALSE)
h_empirical2 <- h_empirical %>% drop_na()
h_empirical2$data <- "Assumed"
h_empirical2 <- h_empirical2 %>% filter(age %in% c("00 years", "01-04 years", "05-09 years", "10-14 years", "15-19 years", "20-24 years", "25-29 years", "85+ years") == FALSE)
h_data_full <- rbind(h_data2 %>% select(race, age, sex, n, data), h_empirical2)

#only keep groups that we have estimates for
h_data_full <- h_data_full %>% unite("group", race, sex, age, sep= " ", remove = FALSE)
temp <- plot_data_pancreas_assumptions %>% unite("group", race, sex, age, sep= " ", remove = FALSE)
for(i in 1:nrow(h_data_full))
{
  if(h_data_full$group[i] %in% temp$group == FALSE)
  {
    h_data_full[i,] <- NA
  }
}
h_data_full <- h_data_full %>% drop_na

N1_data2 <- N1_data %>% drop_na()
N1_data2$data <- "Empirical"
N1_data2 <- N1_data2 %>% filter(age %in% c("00 years", "01-04 years", "05-09 years", "10-14 years", "15-19 years", "20-24 years", "25-29 years", "85+ years") == FALSE)
N1_empirical2 <- N1_empirical %>% drop_na()
N1_empirical2$data <- "Predicted"
N1_empirical2 <- N1_empirical2 %>% filter(age %in% c("00 years", "01-04 years", "05-09 years", "10-14 years", "15-19 years", "20-24 years", "25-29 years", "85+ years") == FALSE)
N1_data_full <- rbind(N1_data2 %>% select(race, age, sex, n, data), N1_empirical2)

#only keep groups that we have estimates for
N1_data_full <- N1_data_full %>% unite("group", race, sex, age, sep= " ", remove = FALSE)
temp <- plot_data_pancreas_assumptions %>% unite("group", race, sex, age, sep= " ", remove = FALSE)
for(i in 1:nrow(N1_data_full))
{
  if(N1_data_full$group[i] %in% temp$group == FALSE)
  {
    N1_data_full[i,] <- NA
  }
}
N1_data_full <- N1_data_full %>% drop_na

N2_data2 <- N2_data %>% drop_na()
N2_data2$data <- "Empirical"
N2_data2 <- N2_data2 %>% filter(age %in% c("00 years", "01-04 years", "05-09 years", "10-14 years", "15-19 years", "20-24 years", "25-29 years", "85+ years") == FALSE)
N2_empirical2 <- N2_empirical %>% drop_na()
N2_empirical2$data <- "Predicted"
N2_empirical2 <- N2_empirical2 %>% filter(age %in% c("00 years", "01-04 years", "05-09 years", "10-14 years", "15-19 years", "20-24 years", "25-29 years", "85+ years") == FALSE)
N2_data_full <- rbind(N2_data2 %>% select(race, age, sex, n, data), N2_empirical2)

#only keep groups that we have estimates for
N2_data_full <- N2_data_full %>% unite("group", race, sex, age, sep= " ", remove = FALSE)
temp <- plot_data_pancreas_assumptions %>% unite("group", race, sex, age, sep= " ", remove = FALSE)
for(i in 1:nrow(N2_data_full))
{
  if(N2_data_full$group[i] %in% temp$group == FALSE)
  {
    N2_data_full[i,] <- NA
  }
}
N2_data_full <- N2_data_full %>% drop_na

#subset by ethnicity
h_data_full_c <- h_data_full %>% filter(race == "Caucasian")
h_data_full_aa <- h_data_full %>% filter(race == "African American")
h_data_full_ap <- h_data_full %>% filter(race == "Asian or Pacific Islander")
h_data_full_h <- h_data_full %>% filter(race == "Hispanic")

fills <- c("Empirical" = "steelblue", "Assumed" = "salmon")
ggplot() +
  geom_density(data = h_data_full_c, aes(x = n, fill = data), alpha = 0.5, bw = 10)+
  facet_wrap(~age+sex, ncol=6)+
  scale_fill_manual(name = "Distribution:", values = fills, breaks=c("Empirical", "Assumed"))+ 
  ggtitle("Do Exogenous Arrivals Constitute a Homogeneous Poisson Point Process - Caucasians")+
  xlab("Number of New Diagnoses in a Year")+
  ylab("Smoothed Probability Mass")+
  theme_light()+
  theme(title = element_text(size = 24),
        axis.title = element_text( size = 24),
        axis.text.x = element_text(size = 10),
        legend.title = element_text(size = 24),
        legend.text = element_text(size = 24),
        strip.text = element_text(size = 18),
        legend.position = "bottom",
        aspect.ratio=0.4)

fills <- c("Empirical" = "steelblue", "Assumed" = "salmon")
ggplot() +
  geom_density(data = h_data_full_aa, aes(x = n, fill = data), alpha = 0.5, bw = 10)+
  facet_wrap(~age+sex, ncol=6)+
  scale_fill_manual(name = "Distribution:", values = fills, breaks=c("Empirical", "Assumed"))+ 
  ggtitle("Do Exogenous Arrivals Constitute a Homogeneous Poisson Point Process - African Americans")+
  xlab("Number of New Diagnoses in a Year")+
  ylab("Smoothed Probability Mass")+
  theme_light()+
  theme(title = element_text(size = 24),
        axis.title = element_text( size = 24),
        axis.text.x = element_text(size = 10),
        legend.title = element_text(size = 24),
        legend.text = element_text(size = 24),
        strip.text = element_text(size = 18),
        legend.position = "bottom",
        aspect.ratio=0.4)

fills <- c("Empirical" = "steelblue", "Assumed" = "salmon")
ggplot() +
  geom_density(data = h_data_full_ap, aes(x = n, fill = data), alpha = 0.5, bw = 10)+
  facet_wrap(~age+sex, ncol=6)+
  scale_fill_manual(name = "Distribution:", values = fills, breaks=c("Empirical", "Assumed"))+ 
  ggtitle("Do Exogenous Arrivals Constitute a Homogeneous Poisson Point Process - Asian or Pacific Islanders")+
  xlab("Number of New Diagnoses in a Year")+
  ylab("Smoothed Probability Mass")+
  theme_light()+
  theme(title = element_text(size = 24),
        axis.title = element_text( size = 24),
        axis.text.x = element_text(size = 10),
        legend.title = element_text(size = 24),
        legend.text = element_text(size = 24),
        strip.text = element_text(size = 18),
        legend.position = "bottom",
        aspect.ratio=0.4)

fills <- c("Empirical" = "steelblue", "Assumed" = "salmon")
ggplot() +
  geom_density(data = h_data_full_h, aes(x = n, fill = data), alpha = 0.5, bw = 10)+
  facet_wrap(~age+sex, ncol=6)+
  scale_fill_manual(name = "Distribution:", values = fills, breaks=c("Empirical", "Assumed"))+ 
  ggtitle("Do Exogenous Arrivals Constitute a Homogeneous Poisson Point Process - Hispanics")+
  xlab("Number of New Diagnoses in a Year")+
  ylab("Smoothed Probability Mass")+
  theme_light()+
  theme(title = element_text(size = 24),
        axis.title = element_text( size = 24),
        axis.text.x = element_text(size = 10),
        legend.title = element_text(size = 24),
        legend.text = element_text(size = 24),
        strip.text = element_text(size = 18),
        legend.position = "bottom",
        aspect.ratio=0.4)

N1_data_full_c <- N1_data_full %>% filter(race == "Caucasian")
N1_data_full_aa <- N1_data_full %>% filter(race == "African American")
N1_data_full_ap <- N1_data_full %>% filter(race == "Asian or Pacific Islander")
N1_data_full_h <- N1_data_full %>% filter(race == "Hispanic")

fills <- c("Empirical" = "steelblue", "Predicted" = "salmon")
ggplot() +
  geom_density(data = N1_data_full_c, aes(x = n, fill = data), alpha = 0.5, bw = 10)+
  facet_wrap(~age+sex, ncol=6)+
  scale_fill_manual(name = "Distribution:", values = fills, breaks=c("Empirical", "Predicted"))+ 
  ggtitle(expression(paste("Distribution of ", N[1]^"*"," - Caucasians")))+
  xlab("Number of Pancreatic Cancer Sufferers at a Given Time Diagnosed and Awaiting Surgery")+
  ylab("Smoothed Probability Mass")+
  theme_light()+
  theme(title = element_text(size = 24),
        axis.title = element_text( size = 24),
        axis.text.x = element_text(size = 10),
        legend.title = element_text(size = 24),
        legend.text = element_text(size = 24),
        strip.text = element_text(size = 18),
        legend.position = "bottom",
        aspect.ratio=0.4)

fills <- c("Empirical" = "steelblue", "Predicted" = "salmon")
ggplot() +
  geom_density(data = N1_data_full_aa, aes(x = n, fill = data), alpha = 0.5, bw = 10)+
  facet_wrap(~age+sex, ncol=6)+
  scale_fill_manual(name = "Distribution:", values = fills, breaks=c("Empirical", "Predicted"))+ 
  ggtitle(expression(paste("Distribution of ", N[1]^"*"," - African Americans")))+
  xlab("Number of Pancreatic Cancer Sufferers at a Given Time Diagnosed and Awaiting Surgery")+
  ylab("Smoothed Probability Mass")+
  theme_light()+
  theme(title = element_text(size = 24),
        axis.title = element_text( size = 24),
        axis.text.x = element_text(size = 10),
        legend.title = element_text(size = 24),
        legend.text = element_text(size = 24),
        strip.text = element_text(size = 18),
        legend.position = "bottom",
        aspect.ratio=0.4)

fills <- c("Empirical" = "steelblue", "Predicted" = "salmon")
ggplot() +
  geom_density(data = N1_data_full_ap, aes(x = n, fill = data), alpha = 0.5, bw = 10)+
  facet_wrap(~age+sex, ncol=6)+
  scale_fill_manual(name = "Distribution:", values = fills, breaks=c("Empirical", "Predicted"))+ 
  ggtitle(expression(paste("Distribution of ", N[1]^"*"," - Asian or Pacific Islanders")))+
  xlab("Number of Pancreatic Cancer Sufferers at a Given Time Diagnosed and Awaiting Surgery")+
  ylab("Smoothed Probability Mass")+
  theme_light()+
  theme(title = element_text(size = 24),
        axis.title = element_text( size = 24),
        axis.text.x = element_text(size = 10),
        legend.title = element_text(size = 24),
        legend.text = element_text(size = 24),
        strip.text = element_text(size = 18),
        legend.position = "bottom",
        aspect.ratio=0.4)

fills <- c("Empirical" = "steelblue", "Predicted" = "salmon")
ggplot() +
  geom_density(data = N1_data_full_h, aes(x = n, fill = data), alpha = 0.5, bw = 10)+
  facet_wrap(~age+sex, ncol=6)+
  scale_fill_manual(name = "Distribution:", values = fills, breaks=c("Empirical", "Predicted"))+ 
  ggtitle(expression(paste("Distribution of ", N[1]^"*"," - Hispanics")))+
  xlab("Number of Pancreatic Cancer Sufferers at a Given Time Diagnosed and Awaiting Surgery")+
  ylab("Smoothed Probability Mass")+
  theme_light()+
  theme(title = element_text(size = 24),
        axis.title = element_text( size = 24),
        axis.text.x = element_text(size = 10),
        legend.title = element_text(size = 24),
        legend.text = element_text(size = 24),
        strip.text = element_text(size = 18),
        legend.position = "bottom",
        aspect.ratio=0.4)

N2_data_full_c <- N2_data_full %>% filter(race == "Caucasian")
N2_data_full_aa <- N2_data_full %>% filter(race == "African American")
N2_data_full_ap <- N2_data_full %>% filter(race == "Asian or Pacific Islander")
N2_data_full_h <- N2_data_full %>% filter(race == "Hispanic")

fills <- c("Empirical" = "steelblue", "Predicted" = "salmon")
ggplot() +
  geom_density(data = N2_data_full_c, aes(x = n, fill = data), alpha = 0.5, bw = 10)+
  facet_wrap(~age+sex, ncol=6)+
  scale_fill_manual(name = "Distribution:", values = fills, breaks=c("Empirical", "Predicted"))+ 
  ggtitle(expression(paste("Distribution of ", N[2]^"*"," - Caucasians")))+
  xlab("Number of Pancreatic Cancer Sufferers Receiving Surgery in a Given Year")+
  ylab("Smoothed Probability Mass")+
  theme_light()+
  theme(title = element_text(size = 24),
        axis.title = element_text( size = 24),
        axis.text.x = element_text(size = 10),
        legend.title = element_text(size = 24),
        legend.text = element_text(size = 24),
        strip.text = element_text(size = 18),
        legend.position = "bottom",
        aspect.ratio=0.4)

fills <- c("Empirical" = "steelblue", "Predicted" = "salmon")
ggplot() +
  geom_density(data = N2_data_full_aa, aes(x = n, fill = data), alpha = 0.5, bw = 10)+
  facet_wrap(~age+sex, ncol=6)+
  scale_fill_manual(name = "Distribution:", values = fills, breaks=c("Empirical", "Predicted"))+ 
  ggtitle(expression(paste("Distribution of ", N[2]^"*"," - African Americans")))+
  xlab("Number of Pancreatic Cancer Sufferers Receiving Surgery in a Given Year")+
  ylab("Smoothed Probability Mass")+
  theme_light()+
  theme(title = element_text(size = 24),
        axis.title = element_text( size = 24),
        axis.text.x = element_text(size = 10),
        legend.title = element_text(size = 24),
        legend.text = element_text(size = 24),
        strip.text = element_text(size = 18),
        legend.position = "bottom",
        aspect.ratio=0.4)

fills <- c("Empirical" = "steelblue", "Predicted" = "salmon")
ggplot() +
  geom_density(data = N2_data_full_ap, aes(x = n, fill = data), alpha = 0.5, bw = 10)+
  facet_wrap(~age+sex, ncol=6)+
  scale_fill_manual(name = "Distribution:", values = fills, breaks=c("Empirical", "Predicted"))+ 
  ggtitle(expression(paste("Distribution of ", N[2]^"*"," - Asian or Pacific Islanders")))+
  xlab("Number of Pancreatic Cancer Sufferers Receiving Surgery in a Given Year")+
  ylab("Smoothed Probability Mass")+
  theme_light()+
  theme(title = element_text(size = 24),
        axis.title = element_text( size = 24),
        axis.text.x = element_text(size = 10),
        legend.title = element_text(size = 24),
        legend.text = element_text(size = 24),
        strip.text = element_text(size = 18),
        legend.position = "bottom",
        aspect.ratio=0.4)

fills <- c("Empirical" = "steelblue", "Predicted" = "salmon")
ggplot() +
  geom_density(data = N2_data_full_h, aes(x = n, fill = data), alpha = 0.5, bw = 10)+
  facet_wrap(~age+sex, ncol=6)+
  scale_fill_manual(name = "Distribution:", values = fills, breaks=c("Empirical", "Predicted"))+ 
  ggtitle(expression(paste("Distribution of ", N[2]^"*"," - Hispanics")))+
  xlab("Number of Pancreatic Cancer Sufferers Receiving Surgery in a Given Year")+
  ylab("Smoothed Probability Mass")+
  theme_light()+
  theme(title = element_text(size = 24),
        axis.title = element_text( size = 24),
        axis.text.x = element_text(size = 10),
        legend.title = element_text(size = 24),
        legend.text = element_text(size = 24),
        strip.text = element_text(size = 18),
        legend.position = "bottom",
        aspect.ratio=0.4)
```
